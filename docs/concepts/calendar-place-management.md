# 장소 관리 시스템 (Place Management System)

> **상위 문서**: [캘린더 시스템](calendar-system.md)
> **관련 문서**: [권한 시스템](permission-system.md)

본 문서는 캘린더 시스템의 **장소 예약 및 관리** 기능을 상세히 설명합니다.

## 개요

특정 장소(예: 동아리방, 랩실, 회의실)의 예약 및 일정 관리를 위한 기능입니다. 장소는 그룹에 의해 관리되며, 다른 그룹은 승인을 통해 사용 권한을 얻거나 관리 주체가 될 수 있습니다.

## 1. 장소의 정의 및 최초 등록

### 1.1. 장소 식별 체계

-   **고유 식별자**: `건물-방 번호` (예: `60주년 기념관-18203`)
-   **사용자 표시**: `건물-방 번호(별칭)` (예: `60주년 기념관-18203(AISC랩실)`)

### 1.2. 최초 등록 프로세스

1.  **등록 권한**: 그룹 관리자 (`CALENDAR_MANAGE` 권한 보유)
2.  **입력 정보**: 건물명, 방 번호, 별칭
3.  **관리 주체 할당**: 등록한 그룹이 자동으로 **최초 관리 주체**가 됨
4.  **중복 방지**: 이미 등록된 장소는 재등록 불가 (현재 관리 그룹 안내)

## 2. 장소 관리 주체의 역할

관리 주체인 그룹의 관리자는 다음 권한을 가집니다:

### 2.1. 핵심 권한

-   **사용 그룹 승인**: 다른 그룹의 '장소 사용 그룹' 신청 승인/거부 (`PLACE_MANAGE` 권한)
-   **예약 관리**: 모든 예약 현황 조회 및 강제 취소 (`PLACE_MANAGE` 권한)
-   **시간 설정**: 예약 가능/불가능 시간 설정 (`PLACE_MANAGE` 권한)

### 2.2. 권한 통합 방식 (확정)

> **설계 결정**: [DD-CAL-001](calendar-design-decisions.md#dd-cal-001-권한-통합-방식) - RBAC 통합 방식 채택

장소 관리 권한은 기존 RBAC 시스템에 통합됩니다:
- `PLACE_MANAGE`: 장소 등록, 사용 그룹 승인, 예약 관리 (관리 주체 그룹의 OWNER)
- `PLACE_RESERVE`: 장소 예약 권한 (사용 그룹 멤버)

**채택 이유**:
- 일관된 권한 확인 로직 (PermissionService 재사용)
- 개발 복잡도 감소
- 사용자 학습 곡선 최소화

**기각된 대안** (Option B - 독립 시스템):
- 장소별 독립 권한 테이블 → 유지보수 복잡도 증가
- 권한 확인 로직 이원화 → 캐싱 전략 분리 필요

## 3. 장소 사용 권한 획득

### 3.1. 사용 그룹 신청 절차

1.  **신청**: 사용하려는 그룹의 관리자 → 관리 그룹의 관리자에게 신청
2.  **승인**: 관리 그룹의 관리자가 신청 승인
3.  **권한 획득**:
    -   신청 그룹의 워크스페이스에 **장소 캘린더 추가**
    -   해당 그룹 멤버들이 일정 생성 시 장소 예약 가능

### 3.2. 예약 권한 범위

-   승인된 '사용 그룹'의 멤버만 예약 가능
-   예약 가능 시간은 관리 주체가 설정한 범위 내

## 4. 관리 주체 변경 (권한 이전)

### 4.1. 이전 절차

1.  **신청**: 새 관리 주체 지망 그룹의 관리자 → 현재 관리 그룹의 관리자에게 신청
2.  **승인**: 현재 관리 그룹의 관리자가 이전 승인
3.  **권한 이전 결과**:
    -   신청 그룹 → 새로운 **관리 주체**
    -   기존 관리 그룹 → **일반 '장소 사용 그룹'**으로 역할 변경
    -   **중요**: 기존 관리 그룹 및 모든 '사용 그룹'의 **사용 권한 유지**

### 4.2. 권한 보존 원칙

-   관리 주체가 변경되어도 이미 승인받은 사용 그룹들의 예약 권한은 유지됨
-   새 관리 주체는 기존 사용 그룹들을 승인 취소할 수 있음

## 5. 일반 사용자 기능

### 5.1. 장소 예약

-   **조건**: 자신의 그룹이 '장소 사용 그룹'으로 승인된 장소만
-   **방법**: 일정 생성 시 장소 선택
-   **제약**: 관리 주체가 설정한 예약 가능 시간 내에서만

### 5.2. 예약 현황 조회

-   장소 캘린더를 통해 시간대별 예약 현황 조회 가능
-   다른 그룹의 예약 정보도 조회 가능 (공개 정보)

---

## 다음 단계

### 데이터베이스 스키마 필요
-   `Place` 엔티티 (건물, 방 번호, 별칭, 관리 그룹 ID)
-   `PlaceUsageGroup` 엔티티 (장소 ID, 그룹 ID, 승인 상태)
-   `PlaceAvailability` 엔티티 (장소 ID, 예약 가능 시간 설정)
-   `PlaceReservation` 엔티티 (장소 ID, 일정 ID, 예약 정보)

### API 설계 필요
-   장소 등록/수정/삭제 API
-   사용 그룹 신청/승인 API
-   관리 주체 이전 API
-   예약 가능 시간 설정 API
-   예약 생성/취소 API

### 권한 시스템 통합 필요
-   장소 관리 권한을 RBAC에 통합할지, 독립 시스템으로 운영할지 결정
-   장소별 권한 매트릭스 설계
