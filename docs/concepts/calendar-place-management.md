# 장소 관리 시스템 (Place Management System)

> **상위 문서**: [캘린더 시스템](calendar-system.md)
> **관련 문서**: [권한 시스템](permission-system.md)

본 문서는 캘린더 시스템의 **장소 예약 및 관리** 기능을 상세히 설명합니다.

## 개요

특정 장소(예: 동아리방, 랩실, 회의실)의 예약 및 일정 관리를 위한 기능입니다. 장소는 그룹에 의해 관리되며, 다른 그룹은 승인을 통해 사용 권한을 얻거나 관리 주체가 될 수 있습니다.

## 1. 장소의 정의 및 최초 등록

### 1.1. 장소 식별 체계

-   **고유 식별자**: `건물-방 번호` (예: `60주년 기념관-18203`)
-   **사용자 표시**: `건물-방 번호(별칭)` (예: `60주년 기념관-18203(AISC랩실)`)

### 1.2. 최초 등록 프로세스

1.  **등록 권한**: 그룹 관리자 (`CALENDAR_MANAGE` 권한 보유)
2.  **입력 정보**: 건물명, 방 번호, 별칭
3.  **관리 주체 할당**: 등록한 그룹이 자동으로 **최초 관리 주체**가 됨
4.  **중복 방지**: 이미 등록된 장소는 재등록 불가 (현재 관리 그룹 안내)

## 2. 장소 관리 주체의 역할

관리 주체인 그룹의 관리자는 다음 권한을 가집니다:

### 2.1. 핵심 권한

-   **장소 등록 및 관리**: 장소 기본 정보 등록/수정 (`CALENDAR_MANAGE` 권한)
-   **사용 그룹 승인**: 다른 그룹의 '장소 사용 그룹' 신청 승인/거부 (`CALENDAR_MANAGE` 권한)
-   **예약 관리**: 모든 예약 현황 조회 및 강제 취소 (`CALENDAR_MANAGE` 권한)
-   **시간 설정**: 예약 가능/불가능 시간 설정 (`CALENDAR_MANAGE` 권한)

### 2.2. 권한 통합 방식 (확정)

> **설계 결정**: [DD-CAL-001](calendar-design-decisions.md#dd-cal-001-권한-통합-및-단순화) - RBAC 통합 + 권한 단순화 방식 채택

장소 관리 권한은 기존 RBAC 시스템에 통합되며, 멤버십 기반 접근 제어를 활용합니다:
- `CALENDAR_MANAGE`: 캘린더 관리 + 장소 관리 권한 통합 (관리 주체 그룹의 그룹장/교수)
- **장소 예약**: 별도 권한 불필요 (PlaceUsageGroup APPROVED + 그룹 멤버 조건으로 자동 판별)

**채택 이유**:
- 일관된 권한 확인 로직 (PermissionService 재사용)
- 개발 복잡도 감소
- 사용자 학습 곡선 최소화
- CALENDAR_MANAGE가 장소 관리를 포함하여 권한 구조 단순화
- **권한 체계 간소화**: 예약은 승인 상태 + 멤버십 기반으로 처리하여 별도 권한 불필요

**기각된 대안**:
- Option A-2 (PLACE_RESERVE 권한 추가): 실제로는 승인 상태 + 멤버십만으로 충분한 기능에 불필요한 권한 추가
- Option B (독립 시스템): 권한 확인 로직 이원화 → 유지보수 복잡도 증가

## 3. 장소 사용 권한 획득

### 3.1. 사용 그룹 신청 절차

1.  **신청**: 사용하려는 그룹의 관리자 → 관리 그룹의 관리자에게 신청
2.  **승인**: 관리 그룹의 관리자가 신청 승인
3.  **권한 획득**:
    -   신청 그룹의 워크스페이스에 **장소 캘린더 추가**
    -   해당 그룹 멤버들이 일정 생성 시 장소 예약 가능

### 3.2. 예약 권한 범위

-   **예약 조건**: PlaceUsageGroup APPROVED 상태 + 그룹 멤버 (`isMember()`)
-   **별도 권한 불필요**: 위 조건만 만족하면 모든 그룹 멤버가 예약 가능
-   **예약 가능 시간**: 관리 주체가 설정한 범위 내 (PlaceAvailability 기준)

## 4. 관리 주체 변경 (권한 이전)

### 4.1. 이전 절차

1.  **신청**: 새 관리 주체 지망 그룹의 관리자 → 현재 관리 그룹의 관리자에게 신청
2.  **승인**: 현재 관리 그룹의 관리자가 이전 승인
3.  **권한 이전 결과**:
    -   신청 그룹 → 새로운 **관리 주체**
    -   기존 관리 그룹 → **일반 '장소 사용 그룹'**으로 역할 변경
    -   **중요**: 기존 관리 그룹 및 모든 '사용 그룹'의 **사용 권한 유지**

### 4.2. 권한 보존 원칙

-   관리 주체가 변경되어도 이미 승인받은 사용 그룹들의 예약 권한은 유지됨
-   새 관리 주체는 기존 사용 그룹들을 승인 취소할 수 있음

## 5. 일반 사용자 기능

### 5.1. 장소 예약

-   **조건**: 자신의 그룹이 '장소 사용 그룹'으로 승인된 장소만
-   **방법**: 일정 생성 시 장소 선택
-   **제약**: 관리 주체가 설정한 예약 가능 시간 내에서만

### 5.2. 예약 현황 조회

-   장소 캘린더를 통해 시간대별 예약 현황 조회 가능
-   다른 그룹의 예약 정보도 조회 가능 (공개 정보)

---

## 6. PlaceAvailability 사용 예시

**시나리오**: AI/SC 랩실의 운영 시간을 설정합니다.

**PlaceAvailability 레코드**:
```
place_id: 1 (AI/SC 랩실)
day_of_week: MONDAY, start_time: 09:00, end_time: 18:00
day_of_week: TUESDAY, start_time: 09:00, end_time: 18:00
day_of_week: WEDNESDAY, start_time: 09:00, end_time: 18:00
day_of_week: THURSDAY, start_time: 09:00, end_time: 18:00
day_of_week: FRIDAY, start_time: 09:00, end_time: 18:00
```

**효과**: 평일 09:00-18:00 시간대만 예약 가능하며, 토요일과 일요일은 예약 불가합니다.

---

## 7. PlaceUnavailableDate 사용 시나리오

**시나리오 1: 임시 공사**
```
place_id: 1 (AI/SC 랩실)
exception_date: 2025-11-15
reason: 전기 공사
```
→ 2025년 11월 15일(금요일)은 정상 운영 시간임에도 불구하고 예약 불가

**시나리오 2: 학교 공휴일**
```
place_id: 1 (AI/SC 랩실)
exception_date: 2025-12-25
reason: 크리스마스 휴무
```
→ 12월 25일은 예약 불가

---

## 확정된 설계 결정사항

> **참조**: [장소 캘린더 개발 명세서](../features/place-calendar-specification.md)

### UI/UX 설계
- **장소 목록**: 건물별 트리 구조
- **장소 캘린더 뷰**: 월간/주간/일간 모두 지원
- **장소 선택**: 바텀시트 방식

### 비즈니스 로직 정책
- **장소 삭제**: Soft delete (신규 예약만 차단)
- **사용 그룹 승인 취소**: 승인 취소 + 미래 예약 자동 삭제 (경고)
- **장소 별칭**: 선택 입력
- **예약-일정 연결**: 예약 삭제 시 장소만 해제, 일정 유지

### 데이터 모델 세부사항
- **운영 시간**: 제외 시간 추가 가능 (여러 시간대 허용)
- **수용 인원**: MVP에서는 정보성만 표시
- **예약 취소 알림**: 알림 시스템 구축 후 적용 예정

### 다음 단계
장소 캘린더 개발 착수 (백엔드 → 프론트엔드 순차 구현)
