# 장소 캘린더 시스템 (Place Calendar System)

그룹이 보유한 장소(동아리방, 랩실, 회의실)의 예약을 관리하는 시스템입니다.

## 개요

장소는 **그룹에 의해 관리**되며, 다른 그룹은 **승인 절차**를 거쳐 사용 권한을 얻습니다.

## 장소 등록

### 등록 권한
`CALENDAR_MANAGE` 권한을 가진 그룹의 관리자

### 등록 정보
- 건물명, 방 번호 (고유 식별자)
- 별칭 (선택사항, 예: "AISC랩실")
- 운영 시간대 (요일별 운영 규칙)

### 관리 주체
등록한 그룹이 자동으로 **최초 관리 주체**가 되며, 다음 권한 보유:
- 장소 정보 수정/삭제
- 사용 그룹 승인/거절
- 예약 현황 조회 및 강제 취소
- 예약 가능 시간 설정

## 사용 권한 획득 (그룹 입장)

### 신청 절차
1. 사용할 그룹의 관리자 → 관리 그룹에 사용 신청
2. 관리 그룹이 승인 → 사용 권한 획득
3. 해당 그룹 멤버들이 예약 가능

### 예약 가능 조건
- PlaceUsageGroup이 **APPROVED** 상태
- 사용자가 **그룹 멤버**
- 예약 시간이 **운영 시간대** 내
- 해당 시간이 **차단되지 않음**

### 예약 취소
승인 취소 시:
- 미래의 모든 예약 자동 삭제
- 일정은 유지 (장소만 해제)

## 예약 가능 시간 판별

### 판별 로직 (4단계)

**1단계: 기본 규칙 확인**
- 특정 요일(예: 월요일)의 운영 규칙 확인
- 규칙이 없으면 → "예약 불가"

**2단계: 차단 시간 확인**
- 특정 날짜의 차단 시간(유지보수, 휴무, 행사) 확인
- 차단되면 → "예약 불가"

**3단계: 기존 예약 확인**
- 해당 날짜의 이미 잡힌 예약 목록 조회

**4단계: 최종 제시**
- [운영 시간] - [차단 시간] - [기존 예약] = 예약 가능 시간 슬롯

### 실제 예시

```
AI/SC 랩실 (월-금 09:00-18:00 운영)

11월 25일 (월요일) 예약 조회:
- 기본 규칙: 월요일 09:00-18:00 ✓
- 차단 시간: 없음 ✓
- 기존 예약: 10:00-11:00, 14:00-15:00
- 결과: [09:00-10:00], [11:00-14:00], [15:00-18:00] 예약 가능
```

## 관리 주체 변경

### 변경 절차
1. 새 관리자 지망 그룹 → 현재 관리 그룹에 변경 신청
2. 현재 관리 그룹이 승인 → 권한 이전

### 권한 이전 결과
- 신청 그룹 → 새로운 **관리 주체**
- 기존 관리 그룹 → **일반 사용 그룹**으로 역할 변경
- **중요**: 모든 사용 그룹의 예약 권한 유지

## 실제 사용 흐름

```
1. AISC (AI/SC 랩실 소유)
   - "AI/SC 랩실" 장소 등록
   - 월-금 09:00-21:00 운영 설정

2. DevOps (다른 그룹)
   - "AI/SC 랩실" 사용 신청
   - AISC 승인 → 사용 권한 획득

3. DevOps 멤버
   - 그룹 캘린더에서 일정 생성
   - "AI/SC 랩실" 선택 → 자동 예약
   - 장소 캘린더에 예약 현황 표시

4. 모든 사용자
   - 장소 캘린더 공개 조회 가능
   - 예약 현황 확인
```

## 권한

| 기능 | 필요 권한 | 추가 조건 |
|------|---------|---------|
| 장소 등록/관리 | `CALENDAR_MANAGE` | 해당 그룹 멤버 |
| 사용 신청 | (없음) | 그룹 관리자 요청 |
| 예약 생성 | (없음) | APPROVED 상태 + 멤버 |
| 예약 취소 | (없음) | 작성자 or `CALENDAR_MANAGE` |
| 장소 캘린더 조회 | (없음) | 인증된 모든 사용자 |

## 관련 문서

- [개인 캘린더 시스템](personal-calendar-system.md) - 개인 시간표/일정
- [그룹 캘린더 시스템](group-calendar-system.md) - 그룹 일정 관리
- [캘린더 통합](calendar-integration.md) - 세 캘린더의 유기적 연동
- [캘린더 설계](../backend/calendar-core-design.md) - 기술 설계 결정사항
- [장소 캘린더 명세](../features/place-calendar-specification.md) - 상세 구현 명세
