# 게시글 및 댓글 컴포넌트 (Post and Comment Components)

## 개요

워크스페이스 내 핵심 소통 수단인 게시글과 댓글 시스템의 컴포넌트별 기능 요구사항과 사용자 경험을 정의합니다.

## 게시글 버블 (PostBubble)

### 기능 목적
- 채널 내 게시글의 시각적 표현
- 작성자 정보와 컨텐츠의 명확한 구분
- 다양한 상호작용 기능 제공

### 시각적 구조

#### 헤더 영역
```
[프로필 이미지] [작성자명] [역할 배지] [작성 시간]
                                      [수정됨 표시]
```

**프로필 이미지**
- 크기: 40px × 40px (데스크톱), 36px × 36px (모바일)
- 기본 이미지: 이니셜 기반 생성
- 온라인 상태 표시 (작은 녹색 점)

**작성자 정보**
- 이름: 실명 또는 닉네임 (설정에 따라)
- 역할 배지: 관리자, 스태프 등 색상 구분
- 호버 시 프로필 카드 표시

**시간 표시**
- 상대적 시간: "5분 전", "2시간 전"
- 절대적 시간: 호버 시 정확한 날짜/시간
- 편집 표시: "편집됨" 라벨 및 편집 시간

#### 컨텐츠 영역
**텍스트 내용**
- 마크다운 렌더링 지원
- 링크 자동 인식 및 미리보기
- 멘션(@username) 하이라이트
- 이모지 렌더링

**첨부 파일**
- 이미지: 썸네일 그리드 표시
- 문서: 파일명, 크기, 다운로드 버튼
- 링크: 자동 링크 카드 생성

#### 액션 영역
```
[좋아요 버튼 + 개수] [댓글 버튼 + 개수] [공유] [더보기 메뉴]
```

**좋아요 시스템**
- 빈 하트/채워진 하트 토글
- 좋아요 개수 실시간 업데이트
- 좋아요 누른 사용자 목록 표시

**댓글 토글**
- 댓글 개수 표시
- 클릭 시 댓글 영역 확장/축소
- 새 댓글 알림 배지

### 상태별 표시

#### 일반 게시글
- 기본 배경색 (흰색/다크 모드 대응)
- 표준 테두리 및 그림자

#### 고정 게시글
- 상단 고정 표시
- 고정 핀 아이콘
- 배경색 강조 (연한 파란색)

#### 공지사항
- 중요 아이콘 (느낌표)
- 배경색 강조 (연한 노란색)
- 굵은 테두리

#### 내 게시글
- 오른쪽 정렬 (채팅 앱 스타일)
- 다른 배경색으로 구분
- 수정/삭제 버튼 표시

### 상호작용 패턴

#### 클릭 영역
- 프로필 이미지: 사용자 프로필 모달
- 작성자명: 사용자 프로필 모달
- 컨텐츠 영역: 게시글 상세 모달 (모바일)
- 시간: 고유 링크 복사

#### 길게 누르기 (모바일)
- 빠른 액션 메뉴 표시
- 좋아요, 댓글, 공유, 신고 옵션

#### 키보드 네비게이션
- Tab 키로 액션 버튼 간 이동
- Enter/Space로 버튼 활성화
- Esc로 열린 댓글 영역 닫기

### 반응형 동작

#### 데스크톱 (≥ 900px)
- 넓은 컨텐츠 영역 활용
- 호버 효과 적극 활용
- 인라인 댓글 표시

#### 모바일 (< 900px)
- 컴팩트한 레이아웃
- 터치 친화적 버튼 크기
- 댓글은 별도 사이드바

### 성능 최적화

#### 가상화 (Virtualization)
- 긴 게시글 목록에서 뷰포트 기반 렌더링
- 이미지 지연 로딩
- 댓글 수 기반 메모리 관리

#### 캐싱 전략
- 렌더링된 마크다운 캐시
- 프로필 이미지 캐시
- 좋아요 상태 로컬 캐시

---

## 게시글 목록 (PostList)

### 기능 목적
- 채널 내 모든 게시글의 효율적 표시
- 스크롤 기반 페이지네이션
- 실시간 업데이트 반영

### 목록 구성

#### 정렬 순서
1. **고정 게시글**: 항상 최상단
2. **일반 게시글**: 작성 시간 역순 (최신 먼저)
3. **로딩 스켈레톤**: 추가 로딩 중 표시

#### 구분자 (Date Separators)
- 날짜별 그룹핑: "오늘", "어제", "2024년 1월 15일"
- 시각적 구분선
- 날짜 점프 네비게이션 지원

### 무한 스크롤

#### 로딩 전략
- 초기 로드: 최신 30개 게시글
- 스크롤 바닥 도달 시: 추가 30개 로드
- 스크롤 최상단 도달 시: 과거 30개 로드 (선택사항)

#### 로딩 상태 표시
- 스켈레톤 UI: 실제 게시글과 유사한 형태
- 스피너: 로딩 중 하단에 표시
- 에러 상태: 재시도 버튼과 함께 표시

#### 성능 고려사항
- 최대 메모리 내 게시글 수 제한 (100개)
- 뷰포트 벗어난 게시글 언마운트
- 이미지 지연 로딩 및 압축

### 실시간 업데이트

#### 새 게시글 알림
- 상단에 "새 게시글 N개" 알림 바
- 클릭 시 최상단으로 스크롤 및 새 게시글 표시
- 자동 업데이트 vs 수동 새로고침 설정

#### 게시글 수정/삭제
- 실시간 내용 변경 반영
- 삭제된 게시글 자동 제거
- 편집 중 상태 표시 (타이핑 인디케이터)

### 빈 상태 처리

#### 채널 첫 진입 (PostEmptyState)
```
[일러스트레이션]
"이 채널에 첫 번째 게시글을 작성해보세요!"
[게시글 작성하기 버튼]
```

#### 검색 결과 없음
```
[검색 아이콘]
"검색 결과가 없습니다"
"다른 키워드로 시도해보세요"
[검색어 지우기 버튼]
```

#### 네트워크 오류
```
[오류 아이콘]
"게시글을 불러올 수 없습니다"
[다시 시도 버튼]
```

---

## 댓글 시스템

### 댓글 토글 버튼 (CommentsToggleButton)

#### 기능 목적
- 게시글별 댓글 영역 표시/숨김 제어
- 댓글 개수 및 상태 표시
- 새 댓글 알림

#### 버튼 상태
**기본 상태**
```
💬 댓글 5개
```

**댓글 영역 열림**
```
💬 댓글 5개 ▲
```

**새 댓글 있음**
```
💬 댓글 5개 🔴
```

#### 상호작용
- 클릭: 댓글 영역 토글
- 댓글 개수 클릭: 첫 번째 댓글로 스크롤
- 길게 누르기: 댓글 빠른 작성 모달

### 댓글 보기 (CommentsView)

#### 레이아웃 구조
**데스크톱**
- 게시글 하단에 인라인 표시
- 최대 높이 제한 (400px)
- 내부 스크롤 영역

**모바일**
- 우측 사이드바로 슬라이드
- 전체 화면 높이 활용
- 상단에 "댓글" 헤더 표시

#### 댓글 목록 구성
1. **댓글 헤더**: 총 댓글 수, 정렬 옵션
2. **댓글 목록**: 시간순 또는 인기순
3. **댓글 작성 입력기**: 하단 고정

### 댓글 타일 (CommentTile)

#### 기본 구조
```
[프로필 이미지] [작성자명] [시간]
                [댓글 내용]
                [좋아요] [답글] [더보기]
  [대댓글들 - 들여쓰기]
    └─ [대댓글 내용]
    └─ [답글 작성 입력기]
```

#### 댓글 컨텐츠
**텍스트 처리**
- 기본 텍스트 (마크다운 제한적 지원)
- 멘션 하이라이트
- 이모지 렌더링
- 링크 자동 인식

**멀티미디어**
- 이미지 첨부 (최대 4개)
- 파일 첨부 (최대 10MB)
- 링크 미리보기

#### 대댓글 시스템
**시각적 구분**
- 들여쓰기 (24px)
- 연결선 표시
- 배경색 약간 변경

**깊이 제한**
- 최대 2단계 깊이
- 3단계부터는 동일 레벨로 평면화
- 원댓글 표시로 맥락 유지

#### 댓글 액션
**기본 액션**
- 좋아요: 하트 토글
- 답글: 대댓글 작성 모드 진입
- 더보기: 신고, 복사, 수정, 삭제

**권한별 액션**
- 작성자: 수정, 삭제
- 관리자: 삭제, 고정, 숨김
- 일반: 신고, 복사

### 댓글 작성

#### 입력 인터페이스
**기본 입력기**
- 자동 높이 조절 텍스트 영역
- 최대 5줄까지 확장
- 플레이스홀더: "댓글을 작성하세요..."

**확장 입력기**
- 포커스 시 도구 모음 표시
- 이모지 피커 버튼
- 파일 첨부 버튼
- 멘션 자동완성

#### 대댓글 작성
**모드 진입**
- 답글 버튼 클릭 시 활성화
- 원댓글 미니 프리뷰 표시
- 취소 버튼으로 모드 해제

**컨텍스트 표시**
```
┌─────────────────────────────────
│ 홍길동님에게 답글
│ "원댓글 내용 일부..."
└─────────────────────────────────
[답글 내용 입력...]
```

#### 실시간 기능
**타이핑 인디케이터**
- "홍길동님이 댓글을 작성 중..."
- 3초간 타이핑 없으면 자동 해제

**자동 저장**
- 10초마다 임시 저장
- 브라우저 새로고침 시 복원
- 작성 취소 시 임시 저장 삭제

---

## 메시지 컴포저 (MessageComposer)

### 기능 목적
- 새 게시글 작성의 핵심 인터페이스
- 다양한 컨텐츠 타입 지원
- 직관적이고 효율적인 작성 경험

### 기본 레이아웃

#### 컴팩트 모드 (기본)
```
[첨부] [텍스트 입력 영역____________] [전송]
```

#### 확장 모드 (포커스 시)
```
┌─────────────────────────────────────────┐
│ [도구 모음: B I U 📷 📎 😀 @]            │
├─────────────────────────────────────────┤
│ [텍스트 입력 영역 - 멀티라인]             │
│                                         │
│                                         │
├─────────────────────────────────────────┤
│ [첨부 파일 미리보기 영역]                │
├─────────────────────────────────────────┤
│                    [취소] [전송] │
└─────────────────────────────────────────┘
```

### 텍스트 입력

#### 기본 기능
- 자동 높이 조절 (최소 2줄, 최대 10줄)
- 플레이스홀더: "무엇을 공유하고 싶으신가요?"
- 글자 수 제한: 5000자

#### 서식 지원
**마크다운 문법**
- **굵게**, *기울임*, ~~취소선~~
- `코드`, ```코드 블록```
- [링크](url), ![이미지](url)
- 실시간 미리보기 토글

**자동완성**
- @멘션: 그룹 멤버 목록
- #채널: 채널 목록
- :이모지: 이모지 목록

#### 입력 도우미
**키보드 단축키**
- Ctrl+B: 굵게
- Ctrl+I: 기울임
- Ctrl+Enter: 전송
- Esc: 작성 취소

**스마트 기능**
- URL 자동 링크 변환
- 이메일 주소 자동 인식
- 전화번호 형식 인식

### 파일 첨부

#### 지원 파일 타입
**이미지**
- JPEG, PNG, GIF, WebP
- 최대 크기: 10MB per file
- 최대 개수: 10개

**문서**
- PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX
- TXT, MD, JSON, XML
- 최대 크기: 100MB per file

**압축 파일**
- ZIP, RAR, 7Z
- 최대 크기: 500MB per file

#### 첨부 방법
**드래그 앤 드롭**
- 컴포저 영역 전체가 드롭 존
- 드래그 중 시각적 하이라이트
- 여러 파일 동시 드롭 지원

**파일 선택기**
- 📎 버튼 클릭
- 다중 선택 지원
- 파일 타입 필터링

**클립보드 붙여넣기**
- Ctrl+V로 이미지 붙여넣기
- 스크린샷 직접 붙여넣기

#### 미리보기 영역
**이미지 미리보기**
- 썸네일 그리드 (최대 3열)
- 개별 이미지 제거 버튼
- 클릭 시 전체 화면 미리보기

**파일 미리보기**
- 파일명, 크기, 타입 아이콘
- 업로드 진행률 표시
- 업로드 실패 시 재시도 버튼

### 전송 처리

#### 전송 조건 검증
- 텍스트 또는 첨부 파일 중 하나 이상 필수
- 파일 크기 제한 확인
- 권한 검증 (채널 쓰기 권한)

#### 전송 프로세스
1. **클라이언트 검증**: 기본 조건 확인
2. **파일 업로드**: 첨부 파일이 있는 경우
3. **게시글 생성**: 서버에 게시글 데이터 전송
4. **실시간 업데이트**: 게시글 목록에 즉시 반영

#### 에러 처리
**네트워크 오류**
- 자동 재시도 (최대 3회)
- 오프라인 시 임시 저장
- 연결 복원 시 자동 전송

**파일 업로드 실패**
- 실패한 파일만 재업로드
- 부분 업로드 지원
- 대안 압축 옵션 제공

**권한 오류**
- 명확한 오류 메시지
- 관리자 문의 안내
- 임시 저장으로 내용 보존

### 모바일 최적화

#### 키보드 대응
- 키보드 표시 시 레이아웃 조정
- 입력 영역 스크롤 보장
- 키보드 숨김 시 원래 위치 복원

#### 터치 인터페이스
- 터치 친화적 버튼 크기 (44px+)
- 스와이프 제스처 지원
- 햅틱 피드백

#### 성능 최적화
- 이미지 자동 압축
- 백그라운드 업로드
- 배터리 사용량 최적화

---

## 접근성 및 국제화

### 접근성 (Accessibility)

#### 키보드 네비게이션
- 모든 상호작용 요소 Tab 접근 가능
- 논리적 포커스 순서
- 스크린 리더 호환

#### ARIA 라벨링
- 버튼 역할 명시
- 상태 변화 알림
- 동적 콘텐츠 업데이트 알림

#### 색상 대비
- WCAG 2.1 AA 기준 준수
- 색상에만 의존하지 않는 정보 전달
- 다크 모드 지원

### 국제화 (i18n)

#### 다국어 지원
- 한국어 (기본)
- 영어 (보조)
- 언어별 폰트 최적화

#### 문화적 고려사항
- 날짜/시간 형식
- 숫자 표기법
- 텍스트 방향 (LTR)

---

## 관련 구현 파일

### 게시글 컴포넌트
- `frontend/lib/presentation/screens/workspace/components/channel_posts/post_bubble.dart`
- `frontend/lib/presentation/screens/workspace/components/channel_posts/post_list.dart`
- `frontend/lib/presentation/screens/workspace/components/channel_posts/post_empty_state.dart`

### 댓글 컴포넌트
- `frontend/lib/presentation/screens/workspace/components/channel_comments/comments_view.dart`
- `frontend/lib/presentation/screens/workspace/components/channel_comments/comment_tile.dart`
- `frontend/lib/presentation/screens/workspace/components/channel_comments/comments_toggle_button.dart`

### 작성 컴포넌트
- `frontend/lib/presentation/screens/workspace/components/channel_composer/message_composer.dart`

### 관련 Provider
- `ChannelProvider`: 채널 및 게시글 상태 관리
- `UIStateProvider`: 댓글 사이드바 등 UI 상태

### 관련 문서
- [워크스페이스 페이지](../pages/workspace-pages.md)
- [실시간 기능 가이드](../realtime-features.md)
- [파일 업로드 가이드](../file-upload.md)