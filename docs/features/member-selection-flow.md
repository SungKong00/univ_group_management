# 멤버 선택 플로우 (Member Selection Flow)

> **문서 예외**: 플로우 참조 가이드 (100줄 제한 예외)

하이브리드 대상 선택 방식(DYNAMIC/STATIC)을 적용한 3단계 멤버 선택 흐름입니다.

## 개요

**목적**: 일정, 공지, 장소 예약 등에서 참여자를 선택할 때, 필터 조건으로 자동 업데이트되는 동적 방식과 고정 명단 방식을 선택할 수 있도록 지원

**핵심 특징**:
- Step 1: 필터 선택 (조건만 선택, 개수 미표시)
- Step 2: Preview API 호출 → DYNAMIC/STATIC 카드 선택
- Step 3: 명단 편집 (STATIC 선택 시만)

## Step 1: 필터 선택

### UI 구성
```
┌──────────────────────────────────┐
│ 참여자 선택                      │
├──────────────────────────────────┤
│ 역할                             │
│ [그룹장] [멤버] [교수] ...       │
│ ↳ 더보기 (3개 더) ▼              │
│                                  │
│ 소속 그룹                        │
│ [AI학회] [데이터학회] ...        │
│                                  │
│ 학년                             │
│ [1학년] [2학년] [3학년] ...      │
│                                  │
│ 학번 (입학년도)                  │
│ [2024년] [2023년] [2022년] ...   │
│ ↳ 더보기 (5개 더) ▼              │
│                                  │
│ 선택된 필터:                     │
│ • 역할: 그룹장, 멤버              │
│ • 소속: AI학회                    │
│ • 학년: 2학년                     │
│                                  │
│              [다음]              │
└──────────────────────────────────┘
```

### 특징
- **개수 미표시**: 필터만 선택, 몇 명인지 보여주지 않음
- **인라인 칩 방식**: ExpandableChipSection 사용 (드롭다운 제거)
- **확장 가능**: 항목이 많으면 "더보기" 버튼으로 확장 (기본 5-6개 표시)
- **조합 로직**: 역할(단독) / 일반 필터(AND) / 학년+학번(OR)

### 데이터 전달
```dart
MemberFilter(roleIds: [1, 3], groupIds: [10], grades: [2])
```

## Step 2: 저장 방식 선택

### Preview API 호출

**Endpoint**: `GET /api/groups/{groupId}/members/preview?roleIds=1,3&groupIds=10&grades=2`

**응답**:
```json
{
  "totalCount": 15,
  "samples": [
    {"id": 1, "name": "홍길동", "grade": 2, "roleName": "그룹장"},
    {"id": 2, "name": "김철수", "grade": 2, "roleName": "멤버"}
  ]
}
```

### UI 구성 (카드 선택)
```
┌────────────────────────────┐
│ 🔄 조건으로 저장 (DYNAMIC) │
│ 총 15명 (홍길동, 김철수...) │
│ ✓ 신규 멤버 자동 포함       │
└────────────────────────────┘

┌────────────────────────────┐
│ 📋 명단으로 저장 (STATIC)  │
│ 총 15명 (홍길동, 김철수...) │
│ ⚠ 고정 명단 (수동 관리)     │
│ → 다음 단계에서 편집 가능   │
└────────────────────────────┘
```

### 선택 결과
- **DYNAMIC 선택**: Step 3 건너뛰고 즉시 저장
- **STATIC 선택**: Step 3으로 이동 (명단 편집)

## Step 3: 명단 편집 (STATIC 전용)

### 진입 조건
Step 2에서 "명단으로 저장" 선택 시만 진입

### UI 구성
```
┌──────────────────────────────────┐
│ 명단 편집                 [확정] │
├──────────────────────────────────┤
│ [역할 (2) ▼] [그룹 (1) ▼]       │
│ [전체 선택] [표시된 멤버 해제]   │
│ 선택됨: 12명                     │
├──────────────────────────────────┤
│ ✓ 홍길동 (2학년, 24학번) 그룹장  │
│ ✓ 김철수 (2학년, 24학번) 멤버    │
│ □ 이영희 (3학년, 23학번) 멤버    │
└──────────────────────────────────┘
```

### 초기 상태
- **필터**: Step 1에서 선택한 필터 그대로 유지
- **체크 상태**: Preview API 결과 15명 모두 체크됨

### 기능
1. **필터 변경**: 다른 조건으로 멤버 조회 가능
2. **체크 유지**: 필터 변경해도 기존 체크 상태 유지
3. **전체 선택/해제**: 현재 표시된 멤버만 대상

### 최종 결과
```dart
List<int> selectedMemberIds = [1, 2, 3, ..., 12] // 편집 후 12명
```

## 데이터 흐름 요약

```
Step 1: MemberFilter 생성
  → MemberFilter(roleIds: [1, 3], groupIds: [10], grades: [2])

Step 2: Preview API 호출
  → GET /preview?roleIds=1,3&groupIds=10&grades=2
  → {totalCount: 15, samples: [...]}

Step 2: STATIC 선택
  → initialFilter: MemberFilter(...)
  → initialSelectedIds: {1, 2, 3, ..., 15}

Step 3: 편집 후 확정
  → selectedMemberIds: [1, 2, 3, ..., 12]
```

## DYNAMIC vs STATIC 비교

| 항목 | DYNAMIC | STATIC |
|------|---------|--------|
| 저장 대상 | MemberFilter 조건 | List\<Int\> ID |
| 신규 멤버 | 자동 포함 | 수동 추가 |
| 업데이트 | 조건 변경 시 자동 | 명단 재편집 |
| 편집 단계 | 없음 | Step 3 |

## 관련 문서

- **API 명세**: [Preview API](member-selection-preview-api.md) - Step 2 API 상세
- **구현 가이드**: [프론트엔드 구현](../implementation/frontend/member-selection-implementation.md) - Step 1-3 구현
- **필터 로직**: [멤버 필터링](../concepts/member-list-system.md) - 필터 조합 원칙
- **UI 컴포넌트**: [멤버 필터 UI](../ui-ux/components/member-list-component.md) - 컴포넌트 구조
