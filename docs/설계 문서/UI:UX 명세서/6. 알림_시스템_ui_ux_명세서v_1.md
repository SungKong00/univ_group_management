# 알림 시스템 UI·UX 명세서 (Toss 철학 적용 · Flutter/Spring Boot) v1.0

> 목적: 중요한 변화를 **놓치지 않게** 하고, 알림을 **방해 없이** 처리할 수 있게 한다. 원칙: 한 화면=한 목표 · 가치 먼저 · 에러는 다음으로 안내 · 일관성(토큰/컴포넌트).

---

## 0. Design Principles (요약)

- **한 화면=한 목표**: 헤더 벨=도착 감지, 드롭다운=빠른 확인/이동, 설정=제어.
- **가치 먼저**: 새 알림 수(Badge) → 핵심 메시지 1\~2줄 + 명확한 목적지(딥링크).
- **가드레일**: 표시된 알림은 자동 읽음(중복 방지), 네트워크 실패 시 재시도/배치 복구.
- **친근/간결한 라이팅**: "승인을 받았어요", "새 가입 신청이 들어왔어요".

---

## 1. 범위 & KPI

- **범위(MVP)**: 헤더 벨/배지 · 드롭다운 알림 목록(최신순) · 자동 읽음 · 항목 클릭 시 원문 딥링크 · 알림 타입(가입 승인/반려, 새 가입 신청, 역할 변경) · 90일 보관 정책 반영.
- **KPI**
  - 첫 확인까지 시간: 벨 클릭→첫 알림 인지 **≤ 2s**
  - 알림→목적지 도달 성공률 **≥ 99%**
  - 잘못된/중복 알림 비율 **< 0.5%**

---

## 2. 페르소나 & 권한

- **일반 사용자**: 본인 관련 알림 수신/읽음/이동.
- **그룹장/관리 권한자**: 본인 관련 + 관리 이벤트(새 가입 신청 등).
- **시스템**: 종료/보관 정책 집행(자동 삭제 90일), 중복 방지/디듀플리케이션.

---

## 3. 정보 구조 & 라우팅(IA)

- **헤더 벨(🔔)** → **드롭다운 목록**(최대 10개, 추가는 스크롤 페이징)
- **알림 항목 클릭** → 해당 화면으로 딥링크(예: 게시글/멤버 관리/그룹 페이지)
- **(차순위)** 전체 보기 페이지(`/notifications`) + 설정(`/settings/notifications`)

---

## 4. 상태 모델(State Model)

- **Notification**: `id, type, title, body, actor, target, createdAt, readAt?, deeplink`
- **읽음 규칙(MVP)**: 드롭다운 **최초 전개 시 화면에 표시된 항목을 일괄 읽음 처리**, 배지 제거. 추가 스크롤 시 가시 범위에 들어온 항목만 점진 읽음.
- **보관 정책**: `createdAt + 90일` 경과 시 자동 삭제(클라이언트는 더 이상 조회 불가로 처리).

상태 전이: `unread → read (open dropdown/scroll) → expired(90d)`

---

## 5. 화면 설계 (Screens)

### A. 헤더 벨 & 배지

- **아이콘**: 벨(🔔)
- **배지**: 읽지 않은 알림 ≥1 → 빨간 점. 배지의 숫자는 표시하지 않음(점만) *(MVP)*.
- **상호작용**: 탭/클릭 → 드롭다운 열기. 포커스 밖 클릭/ESC → 닫기.

### B. 드롭다운 알림 목록

- **레이아웃**: 카드형 리스트(최신순) · 최대 높이 60vh · 스크롤 페이징
- **아이템 구성**
  - 좌: 프로필 썸네일(액터)
  - 우: **제목 1줄**(핵심 메시지) + **본문 1줄**(맥락) + **시간**
  - 배경: 미열람은 살짝 강조(틴트), 열람은 기본 배경
- **상태**
  - **로딩**: 스켈레톤 5개
  - **빈 상태**: "새 알림이 없어요"
  - **에러**: "알림을 불러오지 못했어요" [다시 시도]
- **읽음 처리**: 드롭다운 오픈 시 가시 범위 항목 `readAt` 일괄 PATCH. 스크롤로 추가 표시 시 점진 PATCH.
- **클릭 행동**: 딥링크로 즉시 이동. 실패 시 토스트 + 복구 안내("원문을 찾을 수 없어요").

### C. 알림 타입(문구 & 아이콘)

- **가입 승인**: ✅ "가입 신청이 **승인**되었어요" → [그룹 페이지]
- **가입 반려**: 🚫 "가입 신청이 **반려**되었어요" → [모집/그룹 안내]
- **새 가입 신청(그룹장)**: 📨 "새 **가입 신청**이 들어왔어요" → [멤버 관리 > 가입 대기]
- **역할 변경**: 🏷️ "내 **역할이 {role}**(으)로 변경되었어요" → [멤버/프로필]

(아이콘/색: 승인=Success, 반려=Danger, 신청=Info, 역할변경=Primary)

### D. (선택) 알림 설정 페이지

- **푸시 권한 안내**(모바일/웹-PWA): "브라우저 알림을 허용하면 새 소식을 바로 알려드려요"
- **수신 범주 토글**: 가입/역할/댓글 등 *(MVP는 고정값)*
- **방해 금지 시간(DND)**: 22:00\~08:00 *(후순위)*

---

## 6. 컴포넌트 (Flutter 위젯 예시)

- `NotificationBell({hasUnread, onOpen})`
- `NotificationBadgeDot()`
- `NotificationDropdown({items, onEndReached, onItemTap})`
- `NotificationItem({avatar, title, body, time, unread, onTap})`
- `EmptyState(icon, title, action?) / SkeletonList(count)`

**디자인 토큰**

- 간격: 아이템 패딩 12/16dp, 목록 간격 8dp, 코너 12dp
- 타이포: Title 16/24, Body 14/20, Time 12/16
- 모션: 드롭다운 페이드 180ms, 토스트 2.5s

---

## 7. 마이크로카피 (Toss 톤)

- 빈 상태: **"새 알림이 없어요"**
- 로딩 실패: **"알림을 불러오지 못했어요"** [다시 시도]
- 딥링크 실패: **"원문을 찾을 수 없어요. 나중에 다시 시도해 주세요"**
- 권한 안내: **"브라우저 알림을 허용하면 새 소식을 바로 알려드려요"**

---

## 8. 검증 규칙 & 예외 처리

- 드롭다운 최초 전개 시 **화면에 보이는 항목만** 읽음 처리(가시성 기준). 이후 스크롤 가시 영역 진입 시 점진 처리.
- 딥링크가 무효면(삭제/권한 없음) 안내 토스트 + 드롭다운으로 복귀.
- 네트워크 실패 시 재시도 버튼 제공, 다중 탭에서의 배지 동기화는 폴링/포커스 이벤트로 갱신.
- 서버 보관 정책(90일)으로 삭제된 항목은 클라이언트 목록에서 자동 제외.

---

## 9. 이벤트 & 계측(Analytics)

- `notif_bell_open`(배지 수 포함), `notif_list_fetch`, `notif_item_click(type)`
- `notif_mark_read_batch(count)`, `notif_mark_read_scroll(count)`
- `notif_link_fail`, `notif_retry_click`

---

## 10. API 연동(UX 관점)

- **GET /notifications?limit=10&cursor=** → 최신순 목록(읽음 여부 포함)
- **PATCH /notifications/read** `{ids[]}` → 배치 읽음
- **POST /events/**… → 서버에서 알림 생성(가입 승인/반려, 새 가입 신청, 역할 변경 등)
- **보관 정책**: 서버 크론이 90일 경과 항목 삭제(클라 캐시 무효화)

---

## 11. 텍스트 와이어프레임

### 11.1 헤더 & 드롭다운

```
[🔔]●  (읽지 않음 있으면 빨간 점)
┌─────────────────────────┐
| 내 역할이 스태프로 변경되었어요      3분 전 |
| 새 가입 신청이 들어왔어요            10분 전 |
| 가입 신청이 승인되었어요             2시간 전 |
| …                                    …      |
|————————— (더 불러오는 중 스켈레톤) ————|
|                [끝까지 스크롤 시 추가 로드]  |
└─────────────────────────┘
```

### 11.2 빈/에러 상태

```
(빈)  🔔  새 알림이 없어요
(에러) ⚠️  알림을 불러오지 못했어요   [다시 시도]
```

---

## 12. 수용 기준(AC)

1. 읽지 않은 알림이 있으면 **벨에 빨간 점**이 보인다. 드롭다운을 열면 **가시 항목이 즉시 읽음 처리**되고 점이 사라진다.
2. 알림을 클릭하면 **관련 화면으로 즉시 이동**한다. 목적지가 무효면 안내 토스트가 뜬다.
3. 목록은 **최신순**이며, 로딩/빈/에러 상태가 정의된 UI로 나타난다.
4. 서버의 **90일 보관 정책**을 따른다(만료 항목은 조회/표시되지 않음).
5. 다중 탭/기기에서 배지 수는 **포커스/폴링으로 동기화**된다.

---

## 13. 구현 메모(Flutter)

- 페이지 없음(드롭다운만, 차순위로 전체 보기 페이지). 상태관리: Riverpod.
- Provider 예시: `notificationListProvider(cursor)`, `unreadCountProvider`(포커스 시 리프레시).
- 배치 읽음: 드롭다운 오픈 시 `visibleIds` 수집 → `read` API 호출 → 실패 시 재시도 큐.
- 접근성: 드롭다운 열릴 때 라이브 영역으로 "새 알림 {n}개" 읽어주기, 아이템에 역할/시간 라벨.
- 성능: 메모이제이션된 아바타 이미지, 가상화 리스트, 서버 페이징 10/20.

---

## 14. 로드맵(차순위)

- 전체 보기 페이지 + 검색/필터(타입/기간)
- DND(방해금지), 조용히 전송(배지만)
- 푸시(FCM/웹 푸시) 권한 Onboarding & 토큰 연동
- 멘션/댓글/리액션 등 알림 타입 확대

