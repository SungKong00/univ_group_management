# 게시글/댓글 UI·UX 명세서 (Toss 철학 적용 · Flutter/Spring Boot) v1.0

> 목표: 워크스페이스 채널에서 **빠르고 실수 없이 소통**하게 한다. 사용자에겐 단순함과 속도, 관리자에겐 적절한 중재 도구를 준다. (Slack형 피드, 입력창 하단 고정, 작성/수정/삭제, 1단계 댓글, 반응, 중재 권한 등 기능명세 준수)

---

## 0. Design Principles (요약)

- **한 화면 = 한 목표**: 채널 상세는 "읽기/쓰기", 댓글 시트는 "맥락 합류", 관리자 메뉴는 "중재"에 집중.
- **가치 먼저**: 새 메시지/읽지 않음 발굴이 핵심 가치 → "새 메시지 구분선"·"맨 아래로" FAB로 즉시 도달.
- **에러는 다음으로 안내**: 권한 없음/오프라인/업로드 실패 시 해결 행동(권한 보기/임시저장/재시도) 제시.
- **일관성**: 배지/칩/토스트/모달/Empty/스켈레톤/드롭다운/…메뉴를 공용 컴포넌트로.
- **짧고 친근한 라이팅**: 결과 선언형(“삭제했어요”), 원인+해결 동시 제공.

---

## 1. 범위 & KPI

- **범위(MVP)**: 채널 피드(메시지 읽기/쓰기) · 게시글 CRUD(본인만 수정/삭제) · 댓글(1단계) · 반응(이모지/좋아요) · 파일 첨부 · 관리자 중재(타인 글 삭제) · 시간표시/그룹핑 · 새 메시지 인디케이터.
- **KPI**
  - 첫 입력까지 시간: 채널 진입→첫 타이핑 **p50 ≤ 3s**
  - 스크롤 복귀 속도: 재진입 시 마지막 위치 복원 **≤ 300ms**
  - 업로드 실패율 **< 1%**, 중재 처리 평균 **≤ 3s**

---

## 2. 정보 구조 & 라우팅(IA)

- **워크스페이스/채널 목록** → `/channels/:id` 채널 상세(피드)
- **댓글(스레드) 시트**: 채널 상세 하위 바텀시트(또는 우패널/웹)
- **첨부 미디어 뷰어**: 전체화면 모달(이미지/파일 미리보기)

---

## 3. 상태 모델(State Model)

- **게시글(Post)**: normal | edited | deleted(본문 숨김, "삭제된 메시지예요")
- **댓글(Comment)**: same as Post; **부모 삭제 시 자식 댓글 전부 영구 삭제**(연쇄 삭제)
- **권한(Role)**: 열람 가능 / 작성 가능 / 채널 관리(타인 삭제 가능)
- **연결**: 온라인 | 오프라인(큐잉/재전송) | 업로드중(progress)

상태 전이 예: `draft → sending → sent → edited → deleted`

---

## 4. 화면 설계 (Screens)

### C-1. 채널 상세(피드)

- **헤더**: 채널명, 참여자 수, 더보기(채널 정보/권한 보기)
- **타임라인**
  - **정렬**: 최신 글 **하단**, 위로 갈수록 과거(채팅형)
  - **그룹핑**: 날짜 구분선(오늘/어제/날짜), 연속 메시지 작성자·시간 묶음 처리
  - **새 메시지 구분선**: 마지막 방문 이후 메시지 앞에 "새로 올라온 메시지" 구분선
  - **읽지 않은 수 배지**: 상단/탭 배지로 총합 표시(선택)
- **메시지 카드 구성**
  - 아바타 · 닉네임 · 시각(상대/절대) · 본문(텍스트) · **반응 바** · **댓글 수 칩**
  - 본문 길면 3줄 접기… 더보기
  - **… 메뉴**: 내 글(수정/삭제) · 관리자(삭제)
- **하단 Composer**(고정)
  - 플레이스홀더: "메시지를 입력하세요…"
  - 멀티라인 자동 확장(최대 4줄), 전송 버튼, 파일 첨부 버튼
  - 전송 단축키: 모바일 버튼 / 웹 `Enter`(Shift+Enter 줄바꿈)
- **보조 요소**
  - **맨 아래로 FAB**: 새 메시지 도착 시 우하단 노출, 탭→최신으로 스크롤
  - **파일 업로드 진행**: 썸네일/진행률 바, 실패 시 재시도

### C-2. 댓글(스레드) 바텀시트/패널

- **트리거**: 메시지 카드 하단 "댓글 n" 칩 또는 탭 제스처
- **구성**: 상단 원글 미리보기 → 댓글 리스트(최신 하단) → 댓글 입력창
- **MVP 범위**: **1단계 댓글만**(대댓글 미지원). UI는 대댓글 확장 대비 여백 설계.
- **삭제 정책 노출**: 부모 삭제 시 연쇄 삭제 안내 배지
- **권한**: 댓글도 본인만 수정/삭제, 관리자 중재 가능(타인 댓글 삭제)

### C-3. 중재(관리자)

- **타인 글 삭제**: … 메뉴→[삭제]→ 확인 모달("작성자에게 알림없이 삭제돼요")
- **결과 피드백**: 토스트 "삭제했어요" + 피드에서 즉시 제거(낙관적), 실패 시 복원

### C-4. 오류/오프라인/빈 상태

- **오프라인**: 상단 배너 "인터넷 연결이 필요해요" + 전송 버튼 비활성, Composer에 임시 저장
- **업로드 실패**: 메시지 말풍선에 경고 아이콘 + [다시 시도]
- **권한 없음(작성 불가)**: Composer 전체를 `PermissionGuard`로 교체("이 채널에서는 읽기만 할 수 있어요")
- **빈 상태**: "아직 메시지가 없어요" [첫 글 쓰기]
- **로딩**: 스켈레톤(메시지 5\~7줄)

---

## 5. 컴포넌트 & 인터랙션 (Flutter 위젯 예시)

- `MessageItem({author, avatar, time, content, reactions[], commentCount, isMine, canModerate})`
- `ReactionBar({items, onToggle})` (탭=토글, 길게=전체 이모지 선택)
- `CommentSheet({postId, rootPreview, list, composer})`
- `Composer({text, attachments[], onSend, onAttach})`
- `AttachmentPreviewChip({fileName, size, progress, state: uploading|failed|done})`
- `MoreMenu({canEdit, canDelete, onEdit, onDelete})`
- `DateDivider(date)` / `NewMessageDivider()` / `ScrollToBottomFAB()`
- `PermissionGuard({allowed, child, fallback})`

**디자인 토큰(재사용)**

- 타이포: H2 20/28(작성자), Body 16/24(본문), Caption 13/18(시간)
- 간격: 4dp 그리드, 메시지 사이 8dp, 블록 사이 16dp, 시트 패딩 16dp
- 모션: 시트 상향 200–250ms, 토스트 2.5s, 업로드 진행 60fps

---

## 6. 마이크로카피 (Toss 톤)

- 전송 성공(무음): 시각 피드백만(스크롤 고정/최신 도달)
- 삭제 확인: "이 메시지를 삭제할까요?"
- 삭제 완료: "삭제했어요"
- 수정 완료: "수정을 저장했어요"
- 업로드 실패: "업로드가 실패했어요. 다시 시도해 주세요"
- 권한 없음: "이 채널에서는 읽기만 할 수 있어요"
- 빈 상태: "아직 메시지가 없어요"

---

## 7. 검증 규칙 & 정책(기능명세 반영)

- **작성 권한**: 채널의 "작성 가능 역할"에서만 전송 가능. 그 외는 읽기 전용.
- **수정/삭제**: 사용자는 **자기 게시글/댓글만** 수정/삭제 가능. 관리자(채널 관리 권한)는 타인 글/댓글 삭제 가능.
- **댓글 구조(MVP)**: **1단계 댓글만** 지원. DB는 `parent_comment_id` 컬럼을 미리 둬서 확장 대비.
- **연쇄 삭제**: **부모 댓글 삭제 시 모든 대댓글 영구 삭제**(정책 표시/확인).
- **정렬/시각**: 기본 상대시각("5분 전"), 탭하면 절대시각 툴팁.
- **편집 라벨**: 수정된 메시지에는 "(수정됨)" 표시.

---

## 8. 접근성 & 반응형

- 포커스 이동: 새 메시지 도착 시 스크린리더가 "새 메시지 구분선"을 인식
- 터치 타깃 44dp, …메뉴/반응 버튼 키보드 접근, 시트에 접근성 라벨
- 태블릿/웹: 좌 채널 리스트, 우 피드 · 댓글은 우측 패널(2열 레이아웃)

---

## 9. 이벤트 & 계측(Analytics)

- 피드: `channel_view`, `scroll_bottom_click`, `new_message_seen`
- 작성: `composer_open`, `message_send`, `message_send_fail`
- 댓글: `thread_open`, `comment_send`
- 반응: `reaction_add`, `reaction_remove`
- 중재: `message_delete_moderation`

---

## 10. API 연동(UX 관점)

- **GET /channels/{id}/posts?cursor=** → 피드 페이지네이션(무한 스크롤)
- **POST /channels/{id}/posts** `{text, attachments?[]}` → 작성(오프라인 큐잉 고려)
- **PATCH /posts/{postId}** `{text}` → 수정 (레이튼시 단축을 위해 낙관적 적용)
- **DELETE /posts/{postId}** → 삭제
- **POST /posts/{postId}/reactions** `{emoji}` / **DELETE** → 반응 토글
- **GET /posts/{postId}/comments** / **POST /posts/{postId}/comments** `{text}`
- **DELETE /comments/{commentId}** (부모 삭제 시 서버가 연쇄 처리)
- **Upload**: `/files` 사전 업로드 → 첨부 토큰을 본문과 함께 전송

---

## 11. 텍스트 와이어프레임

### 11.1 채널 상세

```
[헤더]  자유채널           […]
--------------------------------
(오늘) ————————————————
[아바타] 닉네임  5분 전
본문 본문 본문… (더보기)
[👍 3]  [😀 2]   [댓글 4]   […]

(새로 올라온 메시지)

[아바타] 닉네임  1분 전 (수정됨)
본문…
[댓글 0]   […]

           [맨 아래로 ▾]
--------------------------------
[ +첨부 ]  메시지를 입력하세요…         [보내기]
```

### 11.2 댓글 시트

```
┌──────────────────────────────┐
|  원글 미리보기(2줄)          |
|------------------------------|
|  [아바타] 닉네임  2분 전      |
|  댓글 내용…                  |
|  [삭제] […]                  |
|  … (최신 하단)               |
|------------------------------|
|  [첨부] 댓글을 입력하세요…  ▶ |
└──────────────────────────────┘
```

---

## 12. 수용 기준(AC)

1. 채널 진입 시 **마지막 읽은 위치**가 복원되고, 이후 도착 메시지는 **새 메시지 구분선** 위에 쌓인다.
2. 메시지 전송 성공 시 **최신으로 스크롤**되며, 실패 시 말풍선에 재시도 버튼이 노출된다.
3. **권한이 없으면** Composer는 `PermissionGuard`로 대체되고, 전송/첨부 버튼이 보이지 않는다.
4. 댓글은 **1단계만** 가능하며, 부모 삭제 시 자식 댓글이 즉시 사라진다.
5. 관리자는 …메뉴에서 타인 글/댓글에 **삭제**가 노출된다(일반 사용자는 자신의 항목에만).
6. 업로드 진행률이 시각적으로 표시되며, 실패 시 **다시 시도**가 가능하다.

---

## 13. 구현 메모(Flutter)

- 페이지: `ChannelPage` / 위젯: `MessageListView`(역스크롤·무한 스크롤), `Composer`, `CommentSheet`
- 상태: Riverpod 권장. `messageListProvider(channel, cursor)`, `composerProvider`, `threadProvider(postId)`
- 성능: 아이템 키 안정화, 불변 리스트, 이미지 썸네일 지연 로드, 리스트 캐시
- 오프라인: 로컬 큐로 임시 보관 후 재전송, 실패 누적 시 배지 표기

