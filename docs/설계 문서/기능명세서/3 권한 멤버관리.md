### **권한 및 멤버 관리 기능 명세서 (v2.0 - 코드 기준)**

> **🔴 구현 상태:** 백엔드 API 구현 완료
> **📅 최종 업데이트:** 2025-09-19

**1. 권한 시스템 기본 구조**

- **권한 부여 방식:** 모든 권한은 **'역할(Role)'** 단위로 관리됩니다. 그룹장은 커스텀 역할을 생성하고, 역할에 권한을 부여한 뒤, 멤버에게 해당 역할을 지정하는 3단계 방식을 따릅니다.
- **권한 결정:** 사용자의 권한은 자신이 소속된 그룹에서 부여받은 역할(Role)에 의해 결정됩니다.

**2. 고정 역할 정책**

- **2.1. 최상위 '그룹장 (Owner)'**
    - **특징:** 한 그룹에 반드시 한 명만 존재하는 최상위 역할. 수정 및 편집이 불가능합니다.
    - **고유 권한:** 그룹 정보 수정, 그룹 삭제, 그룹장 위임 등 그룹 운영의 모든 핵심 권한을 가집니다.
- **2.2. 기본 '일반 멤버 (Member)'**
    - **특징:** 그룹 가입 시 모든 멤버에게 기본적으로 부여되는 역할입니다.
    - **기본 권한:** 게시글/댓글 조회 및 작성 등 그룹 활동에 필요한 기본적인 권한을 가집니다.

**3. 커스텀 역할 권한 목록 (예시)**

그룹장이 커스텀 역할(예: 스태프, 운영진)을 생성할 때, 아래의 권한들을 자유롭게 조합하여 부여할 수 있습니다.

- **`GROUP_MANAGE_MEMBERS`**: 멤버의 역할을 변경하거나, 가입 신청을 승인/반려하고, 그룹에서 강제 탈퇴시키는 권한.
- **`GROUP_MANAGE_ROLES`**: 새로운 역할을 만들거나 기존 역할을 수정/삭제하는 권한.
- **`GROUP_MANAGE_CHANNELS`**: 워크스페이스 내 채널을 생성, 수정, 삭제하는 권한.
- **`GROUP_POST`**: 게시글을 작성하는 권한.
- **`GROUP_COMMENT`**: 댓글을 작성하는 권한.

**4. 멤버 관리 화면 및 기능 명세**

- **위치:** 그룹 관리 페이지 > '멤버 관리'
- **구성:** '현재 멤버' 목록과 '가입 신청' 목록으로 구성됩니다.

- **4.1. '현재 멤버' 관리**
    - **정보:** 멤버의 프로필, 역할, 가입일 등을 표시합니다.
    - **기능:**
        - **역할 변경:** 멤버의 역할을 다른 역할로 변경합니다.
        - **강제 탈퇴:** 멤버를 그룹에서 제외시킵니다.
        - **그룹장 위임:** 그룹장이 다른 멤버에게 자신의 모든 권한을 넘깁니다.

- **4.2. '가입 신청' 관리**
    - **정보:** 가입 신청자의 프로필 정보와 신청 메시지를 표시합니다.
    - **기능:**
        - **승인:** 신청자는 '일반 멤버'로 즉시 그룹에 가입됩니다.
        - **거절:** 신청자의 가입 요청을 반려합니다.

**5. 정책 및 규칙**

- **자신 역할 변경 불가:** 사용자는 자신의 역할을 스스로 변경할 수 없습니다.
- **역할 삭제 시 처리:** 특정 커스텀 역할이 삭제될 경우, 해당 역할을 가졌던 모든 멤버는 '일반 멤버' 역할로 자동 변경됩니다.

**6. MVP 제외 범위**

- **멤버별 개별 권한 수정 기능 (Personal Permission Override)**
- 여러 멤버를 동시 선택하여 관리하는 기능

---

### 7. API 명세 (v2.0 - 코드 기준)

| 기능 | HTTP Method | URI | 권한 | 설명 |
| --- | --- | --- | --- | --- |
| **멤버 목록 조회** | `GET` | `/api/groups/{groupId}/members` | 그룹 읽기 권한 | 그룹의 현재 멤버 목록을 조회합니다. |
| **가입 신청 목록 조회** | `GET` | `/api/groups/{groupId}/join-requests` | 멤버 관리 권한 | 해당 그룹에 온 가입 신청 목록을 조회합니다. |
| **가입 신청 처리** | `PATCH` | `/api/groups/{groupId}/join-requests/{requestId}` | 멤버 관리 권한 | 가입 신청을 승인 또는 반려합니다. (`{action: "APPROVE|REJECT"}`) |
| **멤버 역할 변경** | `PUT` | `/api/groups/{groupId}/members/{userId}/role` | 멤버 관리 권한 | 특정 멤버의 역할을 변경합니다. (`{roleId: ...}`) |
| **멤버 강제 탈퇴** | `DELETE` | `/api/groups/{groupId}/members/{userId}` | 멤버 관리 권한 | 멤버를 그룹에서 강제 탈퇴시킵니다. |
| **그룹장 위임** | `POST` | `/api/groups/{groupId}/transfer-ownership/{newOwnerId}` | 그룹장 | 그룹장 권한을 다른 멤버에게 위임합니다. |
| **역할 목록 조회** | `GET` | `/api/groups/{groupId}/roles` | 멤버 관리 권한 | 그룹 내 모든 역할 목록을 조회합니다. |
| **역할 생성** | `POST` | `/api/groups/{groupId}/roles` | 역할 관리 권한 | 새로운 커스텀 역할을 생성합니다. |
| **역할 수정** | `PUT` | `/api/groups/{groupId}/roles/{roleId}` | 역할 관리 권한 | 역할의 이름 또는 권한을 수정합니다. |
| **역할 삭제** | `DELETE` | `/api/groups/{groupId}/roles/{roleId}` | 역할 관리 권한 | 역할을 삭제합니다. |

### 8. DTO (Data Transfer Object) 정의 (주요 항목)

- **MemberDto**: `{ userId, nickname, profileImageUrl, role, joinedAt }`
- **JoinRequestAction**: `{ action: "APPROVE" | "REJECT" }`
- **UpdateRoleRequest**: `{ roleId: Long }`
- **RoleDto**: `{ roleId, roleName, permissions: List<String> }`
- **CreateRoleRequest**: `{ name, permissions, priority }`
