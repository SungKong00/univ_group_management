# 1. 회원가입 / 로그인

**1. 개요 (Overview)**

- **1.1. 기능 정의:** 사용자가 가입 시 자신의 역할(학생 또는 교수)을 선택하고, Google 소셜 계정을 통해 간편하게 인증을 시작하며, 서비스에 필요한 추가 정보 및 학교 이메일 인증을 통해 최종적으로 가입을 완료하는 기능. 교수 역할 선택 시 관리자의 승인 절차를 포함한다.
- **1.2. 목표 및 기대 효과:** 사용자가 자신의 역할에 맞는 명확한 절차에 따라 2분 내에 간편하고 안전하게 가입을 완료하게 한다.
- **1.3. 범위 (Scope):** Google 소셜 로그인, 역할(학생/교수) 선택, 추가 정보(실명, 닉네임 등) 입력, 학교 이메일 인증, 교수 역할 관리자 승인.

**2. 사용자 요구사항 (Requirements)**

- **2.1. 주요 페르소나:** 신규 가입 학생, 신규 가입 교수/교직원.
- **2.2. 사용자 스토리:**
    - (학생) "나는 Google 계정으로 간편하게 가입하고, 학교 이메일 인증까지 빠르게 마치고 싶다."
    - (교수) "나는 간편히 가입하되, 내 역할이 안전하게 인증받기를 원한다. 승인 전까지 일부 기능 사용이 제한되더라도 이해할 수 있다."
- **2.3. 기능 요구사항:** Google OAuth2 사용, 역할(학생/교수) 선택 필수, 실명/닉네임/학과/학번 입력 필수, 닉네임 중복 불가, 학교 이메일 인증 코드(6자리, 5분 유효) 발송, 교수 역할 신청 시 '승인 대기' 권한 부여 및 관리자 알림.

**3. UX/UI 및 플로우 (Toss UI/UX 적용)**

- **핵심 철학:** `하나의 화면엔, 하나의 목표만`. 사용자가 각 단계의 목표에만 완벽하게 집중하도록 전체 화면을 사용하는 페이지로 구성한다.
- **3.1. 사용자 플로우차트 (Flowchart)**
    1. **시작 (화면 1: 역할 선택):** 사용자는 **[학생으로 시작하기]** 또는 **[교수/교직원으로 시작하기]** 버튼 중 하나를 선택하는 단일 목표에 집중한다.
    2. **인증 (Google 인증):** [Google 계정으로 계속하기] 선택 후 Google 인증 진행.
    3. **정보 입력 (화면 2: 프로필 및 학교 인증):**
        - 사용자는 **하나의 화면**에서 스크롤하며 실명, 닉네임, 학과, 학번, 학교 이메일을 모두 입력한다.
        - [인증 코드 받기] 버튼을 누르면 페이지 전환 없이, 같은 화면에서 인증 코드 입력 필드가 활성화되고 타이머가 동작한다.
        - 모든 정보 입력 후 하단의 **[가입 완료]** 버튼을 누른다.
    4. **권한 부여:** 역할에 따라 권한을 부여하고 메인 화면으로 이동한다.
        - (교수 선택 시) '교수 승인 대기' 권한을 부여하고, 앱 내 모든 화면 상단에 인증 대기 상태를 알리는 배너를 노출한다.
- **3.2. 화면 구성 (UI Components)**
    - **화면 1: 역할 선택:** 화면 중앙에 명확한 질문("어떤 역할로 시작하시겠어요?")과 두 개의 큰 버튼만으로 구성.
    - **화면 2: 프로필 및 학교 인증:** 불필요한 장식 없이 입력 필드에만 집중할 수 있는 UI. 각 필드에 대한 안내(Placeholder)를 명확하게 제공. 오류 발생 시 필드 하단에 즉시 에러 메시지 표시.

**4. 예외 처리 및 제약사항 (Edge Cases & Constraints)**

- **가입 중단:** 가입 절차 중 이탈 시 진행 상태는 저장되지 않음.
- **닉네임 중복:** 중복 시 "이미 사용 중인 닉네임입니다." 에러 즉시 표시.
- **인증 코드 오류:** 코드 불일치 또는 시간 만료 시 적절한 에러 메시지 표시.
- **교수 인증 반려:** 반려 시 사용자에게 알림을 보내고 권한은 '학생'으로 자동 변경.

**5. 성공 지표 (Success Metrics)**

- **가입 전환율:** [Google 로그인 시작] 대비 [가입 완료] 비율.
- **평균 가입 소요 시간:** 역할 선택부터 가입 완료까지의 평균 시간.

---

### 6. API 명세

| 기능 | HTTP Method | URI | Request Body | Response Body | 설명 |
| --- | --- | --- | --- | --- | --- |
| **소셜 로그인 시작** | GET | /oauth2/authorization/{provider} | | (Redirect) | Google 등 소셜 로그인을 시작하고, 제공자 인증 페이지로 리디렉션합니다. |
| **소셜 로그인 콜백** | GET | /oauth2/callback/{provider} | | `AuthResponse` | 소셜 로그인 성공 후, 서비스의 토큰(JWT)을 발급받거나 추가 정보 입력 단계로 안내합니다. |
| **닉네임 중복 확인** | GET | /auth/nickname/check?value={nickname} | | `CheckNicknameResponse` | 가입 중 닉네임 중복 여부를 확인합니다. |
| **학교 이메일 인증코드 발송** | POST | /auth/verify-email/send | `SendCodeRequest` | (202 Accepted) | 학교 이메일로 6자리 인증 코드를 발송합니다. |
| **학교 이메일 인증코드 확인** | POST | /auth/verify-email/confirm | `ConfirmCodeRequest` | `VerificationResponse` | 수신한 인증 코드가 유효한지 확인합니다. |
| **최종 회원가입** | POST | /auth/register | `RegisterRequest` | `AuthResponse` | 모든 정보를 취합하여 최종 가입을 완료하고 토큰을 발급받습니다. |

### 7. DTO (Data Transfer Object) 정의

- **AuthResponse**
    - `accessToken: String`
    - `refreshToken: String`
    - `isNewUser: Boolean` (추가 정보 입력 필요 여부)
- **CheckNicknameResponse**
    - `isAvailable: Boolean`
- **SendCodeRequest**
    - `email: String`
- **ConfirmCodeRequest**
    - `email: String`
    - `code: String`
- **VerificationResponse**
    - `isVerified: Boolean`
    - `verificationToken: String` (최종 가입 시 사용할 이메일 인증 토큰)
- **RegisterRequest**
    - `role: String` (e.g., "STUDENT", "PROFESSOR")
    - `name: String`
    - `nickname: String`
    - `department: String`
    - `studentId: String`
    - `emailVerificationToken: String`
