# 6. 알림 시스템 (v2.0 - 설계 확정)

> **🔵 구현 상태:** 설계 확정 (백엔드 구현 필요)
> **📅 최종 업데이트:** 2025-09-19

### 1. 기술 아키텍처 (실시간 PUSH 방식)

- **핵심 기술: SSE (Server-Sent Events)**
    - 클라이언트가 주기적으로 요청하는 폴링(Polling) 방식 대신, 서버가 클라이언트에게 직접 알림을 보내주는 **실시간 PUSH 방식**을 채택합니다.
    - 클라이언트는 접속 시 알림 구독 API를 호출하여 서버와 단일 연결을 유지하고, 서버는 새로운 알림이 발생할 때마다 이 연결을 통해 즉시 알림 데이터를 전송합니다.
- **구조화된 데이터 저장**: 향후 개인화 기능 확장을 위해, 알림 데이터는 발생 주체, 대상, 종류 등 모든 정보를 포함하는 **구조화된 데이터**로 저장합니다.
- **데이터 보관 정책**: 생성된 지 **90일이 지난 알림 데이터는 자동으로 삭제**하는 기간제 보관 정책을 채택합니다.

### 2. 사용자 경험 (UX/UI)

- **실시간 상태 표시**: 새로운 알림이 SSE를 통해 수신되면, 서비스 상단 헤더의 **종(🔔) 아이콘** 위에 **빨간 점(Badge)**이 즉시 표시됩니다.
- **알림 목록**: 종 아이콘 클릭 시, 최신순으로 정렬된 알림 목록이 드롭다운 형태로 나타납니다.
- **자동 읽음 처리**: 사용자가 알림 드롭다운 목록을 열면, 클라이언트는 **읽음 처리 API를 한 번 호출**하여 모든 알림을 '읽음' 상태로 변경하고 빨간 점을 즉시 사라지게 합니다.
- **클릭 시 이동**: 사용자가 특정 알림을 클릭하면, 해당 활동이 발생한 페이지(예: 댓글이 달린 게시물)로 즉시 이동합니다.

### 3. MVP에 포함될 알림 종류 (Triggers)

- 내 그룹 가입 신청이 **승인 또는 거절**되었을 때
- 내가 그룹장인 그룹에 **새로운 가입 신청**이 들어왔을 때
- 나의 **역할이 변경**되었을 때
- 내 게시물에 **새로운 댓글**이 달렸을 때

---

### 4. API 명세 (설계 확정안)

| 기능 | HTTP Method | URI | 설명 |
| --- | --- | --- | --- |
| **알림 실시간 구독** | `GET` | `/api/notifications/subscribe` | SSE 연결을 위한 엔드포인트. `text/event-stream` 타입으로 응답. |
| 알림 목록 조회 | `GET` | `/api/notifications?limit={limit}&cursor={cursor}` | 커서 기반 페이지네이션으로 과거 알림 목록을 최신순으로 조회. |
| **알림 전체 읽음 처리** | `POST` | `/api/notifications/read-all` | 현재 사용자의 모든 읽지 않은 알림을 '읽음' 상태로 변경. |

### 5. DTO (Data Transfer Object) 정의

- **PagedResult<T>**: `{ data: List<T>, nextCursor: String }`
- **NotificationDto** (SSE 및 목록 조회 시 사용)
    - `notificationId: Long`
    - `type: String` (e.g., "JOIN_APPROVED", "NEW_COMMENT")
    - `title: String`
    - `body: String`
    - `actor: { userId, nickname, profileImageUrl }`
    - `isRead: Boolean`
    - `createdAt: DateTime`
    - `deeplink: String` (클릭 시 이동할 프론트엔드 경로)