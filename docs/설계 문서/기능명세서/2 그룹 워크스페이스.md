# 2. 그룹 / 워크스페이스

### **그룹/워크스페이스 기능 명세서 (v1.3)**

**1. 기능 개요**

- 본 기능은 사용자들이 공통의 목표를 가진 커뮤니티(그룹)를 형성하고, 해당 그룹 전용의 협업 공간(워크스페이스)을 생성 및 운영할 수 있도록 지원한다. 명확한 관리 체계와 승인 절차를 통해 체계적인 그룹 관리를 목표로 한다.

**2. 사용자 역할 및 권한**

| 역할 | 설명 | 주요 권한 |
| --- | --- | --- |
| **시스템 관리자** | 서비스 전체를 관리하는 최고 권한자 | • 최상위 그룹 생성<br>• 그룹장 유고 시 개입 및 권한 처리 |
| **그룹장** | 개별 그룹의 운영을 총괄하는 **학생 대표** | • 하위 그룹 신청 승인/반려<br>• 멤버 가입 신청 승인/반려<br>• **지도교수 지정/해제**<br>• 그룹장 권한 위임<br>• 그룹 삭제 |
| **지도교수** | 그룹장이 지정한 **담당 교직원**.<br>그룹장과 동일한 권한을 가짐 | • **그룹장과 모든 권한 공유**<br>• 단, 그룹장 또는 다른 지도교수를 해임/지정할 수 없음 |
| **그룹 멤버** | 그룹에 소속된 일반 사용자 | • 콘텐츠 열람 및 생성<br>• 그룹 탈퇴 |
| **일반 사용자** | 그룹에 소속되지 않은 사용자 | • 그룹 검색 및 정보 조회<br>• 그룹 가입 신청 |

#### 2.1 전역 역할과 그룹 역할의 분리
- 전역 역할(GlobalRole): `STUDENT`, `PROFESSOR`, `ADMIN` — 시스템 전역 범위에서만 사용 (JWT `auth`)
- 그룹 역할(GroupRole): 그룹 내 역할 — `OWNER(그룹장)`, `ADVISOR(지도교수)`, `MEMBER` + 커스텀 역할
- 일반 사용자는 해당 그룹에 `GroupMember` 레코드가 없으면 비멤버로 취급

#### 2.2 권한(permissions) 카탈로그와 시스템 역할 프리셋
- 권한 카탈로그 예: `GROUP_MANAGE`, `MEMBER_VIEW`, `MEMBER_APPROVE`, `MEMBER_KICK`, `ROLE_MANAGE`, `CHANNEL_READ`, `CHANNEL_WRITE`, `POST_CREATE`, `POST_UPDATE_OWN`, `POST_DELETE_OWN`, `POST_DELETE_ANY`, `RECRUITMENT_CREATE`, `RECRUITMENT_UPDATE`, `RECRUITMENT_DELETE`
- 시스템 역할 프리셋(권장):
  - OWNER: 모든 권한 보유
  - ADVISOR: OWNER와 동일하되 OWNER/ADVISOR 인사권 제한(정책에 따라 예외 처리)
  - MEMBER: 읽기, 작성 및 자기 글 관리 권한 중심
- 상세 카탈로그 및 매핑은 "권한 모델 및 카탈로그" 문서 참조

**3. 주요 기능 명세**

- **3.1. 그룹 생성 및 신청:** 시스템 관리자는 최상위 그룹을, 일반 사용자는 하위 그룹 생성을 신청할 수 있다.
- **3.2. 승인 워크플로우:** 그룹장은 하위 그룹 생성 및 멤버 가입 신청을 승인/반려한다.
- **3.3. 그룹장 기능**
    - **3.3.1. 지도교수 지정/해제 (신규):** '멤버 관리'에서 '교수' 신분 태그를 가진 멤버를 '지도교수로 지정'하거나 해제할 수 있다.
    - **3.3.2. 그룹장 권한 위임:** 탈퇴 전 반드시 다른 멤버에게 그룹장 권한을 위임해야 한다.
    - **3.3.3. 멤버 강제 탈퇴:** 그룹 멤버를 강제로 제외시킬 수 있다.
    - **3.3.4. 그룹 삭제 (UI/UX 변경):**
        - **프로세스:** '그룹 삭제' 버튼 클릭 시, 화면 하단에서 **바텀 시트(Bottom Sheet)**가 올라온다. 바텀 시트에는 삭제될 데이터(**멤버 N명, 게시물 N개 등**)가 명확하게 요약 표시되며, 최종 확인을 위해 **빨간색 [삭제] 버튼**을 눌러야 한다. **문구를 직접 입력하는 절차는 삭제한다.**

—

**4. 커스텀 역할 운영 정책**

- 생성: `POST /groups/{groupId}/roles { name, permissions[] }`
  - 생성/수정/삭제는 OWNER 또는 `ROLE_MANAGE` 권한 보유자만 수행 가능
  - 그룹 내 이름 고유(Unique)
  - 시스템 역할(OWNER/ADVISOR/MEMBER)은 수정/삭제 불가
- 할당: `PUT /groups/{groupId}/members/{userId}/role { roleId }`
  - OWNER 또는 `ROLE_MANAGE` 권한 필요
- 조회: `GET /groups/{groupId}/roles`, `GET /groups/{groupId}/members`
- 권한 검사: `@PreAuthorize("hasPermission(#groupId, 'GROUP', '<PERMISSION>')")` 표준 사용
- **3.4. 예외 처리:**
    
    **3.4.1. 그룹장 유고 상황 처리 (정책 수정)**
    
    - **상황:** 그룹장이 장기 미접속, 계정 삭제 등으로 권한 위임을 할 수 없는 경우
    - **처리 주체:** 시스템
    - **프로세스 (MVP 단순화):** 그룹장이 유고 상태가 되면, 시스템은 해당 그룹 내의 멤버 중 **가입일이 가장 오래되고 학년 정보가 높은 멤버를 임시 그룹장으로 자동 지정**한다. (별도 관리자 개입 없음)

**5. 데이터 및 정책**

- **4.1. 데이터 삭제 정책:**
    - **그룹/워크스페이스 삭제:** 그룹 삭제 시, 해당 그룹 및 워크스페이스의 모든 데이터(멤버들의 게시물 포함)는 복구 불가능하게 **즉시 영구 삭제된다.**
    - **사용자 탈퇴:** 사용자가 서비스를 탈퇴하더라도, 다른 멤버들의 대화 흐름 유지를 위해 작성했던 메시지와 댓글은 **삭제되지 않고 '(탈퇴한 사용자)'로 익명화 처리**된다.
    - **초기 개발 단계 (MVP):** 상위 그룹이 삭제되면, 소속된 모든 하위 그룹도 **연쇄적으로 함께 삭제된다.** (단, 이 정책은 서비스 안정성에 위험이 될 수 있음을 인지하고 추후 개선 과제로 남긴다.)

---

###
