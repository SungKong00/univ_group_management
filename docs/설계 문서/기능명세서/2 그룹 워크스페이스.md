### **그룹/워크스페이스 기능 명세서 (v1.4 - 구현 완료)**

> **🔴 구현 상태:** 백엔드 API 완전 구현 완료, 프론트엔드 UI 부분 구현
> **📅 최종 업데이트:** 2025-09-16

**1. 기능 개요**

- 본 기능은 사용자들이 공통의 목표를 가진 커뮤니티(그룹)를 형성하고, 해당 그룹 전용의 협업 공간(워크스페이스)을 생성 및 운영할 수 있도록 지원한다. 명확한 관리 체계와 승인 절차를 통해 체계적인 그룹 관리를 목표로 한다.

**2. 사용자 역할 및 권한**

| 역할 | 설명 | 주요 권한 |
| --- | --- | --- |
| **시스템 관리자** | 서비스 전체를 관리하는 최고 권한자 | • 최상위 그룹 생성<br>• 그룹장 유고 시 개입 및 권한 처리 |
| **그룹장** | 개별 그룹의 운영을 총괄하는 **학생 대표** | • 하위 그룹 신청 승인/반려<br>• 멤버 가입 신청 승인/반려<br>• **지도교수 지정/해제**<br>• 그룹장 권한 위임<br>• 그룹 삭제 |
| **지도교수** | 그룹장이 지정한 **담당 교직원**.<br>그룹장과 동일한 권한을 가짐 | • **그룹장과 모든 권한 공유**<br>• 단, 그룹장 또는 다른 지도교수를 해임/지정할 수 없음 |
| **그룹 멤버** | 그룹에 소속된 일반 사용자 | • 콘텐츠 열람 및 생성<br>• 그룹 탈퇴 |
| **일반 사용자** | 그룹에 소속되지 않은 사용자 | • 그룹 검색 및 정보 조회<br>• 그룹 가입 신청 |

**3. 주요 기능 명세**

**3.1. 그룹 생성 및 신청**

- **3.1.1. 최상위 그룹 생성 (시스템 관리자 전용)**
    - **사용자:** 시스템 관리자
    - **목적:** 대학, 단과대, 계열, 학과 등 대학의 기본 조직이 되는 **'뿌리' 그룹**을 생성.
    - **프로세스:**
        1. 관리자 도구를 통해 직접 그룹과 워크스페이스를 생성한다.
        2. 해당 그룹의 초기 그룹장(예: 학과 학생회장)을 지정한다.
- **3.1.2. 하위 그룹 생성 신청 (일반 사용자)**
    - **사용자:** 일반 사용자
    - **목적:** 특정 상위 그룹(예: '컴퓨터공학과' 그룹) 내에 소속될 하위 그룹(예: '알고리즘 스터디', '캡스톤 디자인 1팀') 생성을 신청.
    - **프로세스:**
        1. 사용자는 하위 그룹을 만들고 싶은 **상위 그룹 페이지**로 이동한다.
        2. '하위 그룹 만들기' 버튼을 클릭한다.
        3. 그룹명, 소개 등 필요한 정보를 입력 후 제출한다.
        4. 신청서는 **해당 상위 그룹의 그룹장**에게 전달된다.
        5. 신청자는 '내 정보 > 신청 현황'에서 상태를 확인할 수 있다.

**3.2. 승인 워크플로우**

- **3.2.1. 하위 그룹 신청 관리 (그룹장 전용)**
    - **사용자:** 그룹장
    - **위치:** 그룹 관리 페이지 > '하위 그룹 신청 관리' 탭
    - **프로세스:**
        1. 자신의 그룹에 접수된 하위 그룹 생성 신청 목록을 확인한다.
        2. **[승인 시]** 신청된 하위 그룹이 즉시 생성되며, 신청자는 해당 하위 그룹의 초대 그룹장이 된다.
        3. **[반려 시]** 반려 사유를 선택/입력 후 최종 반려 처리한다.
        4. 처리 결과는 신청자에게 알림으로 전달된다.
- **3.2.2. 멤버 가입 신청 관리**
    - **사용자:** 그룹장, 시스템 관리자
    - **위치:** 관리자 페이지 > '멤버 가입 신청' 탭 / 그룹 관리 페이지 > '멤버 관리'
    - **프로세스:**
        1. 가입 신청자 목록을 확인한다.
        2. **[승인 시]** 신청자는 그룹 멤버로 즉시 추가된다.
        3. **[반려 시]** 반려 사유를 선택/입력 후 최종 반려 처리한다.
        4. 처리 결과는 신청자에게 알림으로 전달된다.

**3.3. 그룹장 기능**

- **3.3.1. 그룹장 권한 위임**
    - **사용자:** 그룹장
    - **위치:** 그룹 관리 페이지 > '멤버 관리'
    - **정책:** 그룹장은 탈퇴 전 반드시 다른 멤버에게 그룹장 권한을 위임해야만 탈퇴가 가능하다.
    - **프로세스:**
        1. 멤버 목록에서 위임할 멤버를 선택하고 '그룹장 위임' 버튼을 클릭한다.
        2. "그룹장 권한을 위임하시겠습니까?" 확인 팝업에서 '확인'을 누른다.
        3. 기존 그룹장은 일반 멤버로 강등되고, 선택된 멤버가 새로운 그룹장이 된다.
        4. 양쪽 사용자 모두에게 역할 변경에 대한 알림이 발송된다.
- **3.3.2. 멤버 강제 탈퇴**
    - **사용자:** 그룹장
    - **위치:** 그룹 관리 페이지 > '멤버 관리'
    - **프로세스:**
        1. 멤버 목록에서 탈퇴시킬 멤버를 선택하고 '강제 탈퇴' 버튼을 클릭한다.
        2. 확인 팝업에서 '확인'을 누르면 해당 멤버는 즉시 그룹에서 제외된다.
- **3.3.3. 그룹 삭제**
    - **사용자:** 그룹장
    - **위치:** 그룹 관리 페이지 > '그룹 설정'
    - **프로세스:**
        1. '그룹 삭제' 버튼을 클릭한다.
        2. 삭제의 위험성을 알리는 경고 팝업과 함께 그룹명을 직접 입력하여 확인하는 절차를 거친다.
        3. 확인 시 그룹 및 연관된 워크스페이스의 모든 데이터가 즉시 삭제된다. (하기 4.1. 정책 참조)
- **3.4. 예외 처리:**
    
    **3.4.1. 그룹장 유고 상황 처리 (정책 수정)**
    
    - **상황:** 그룹장이 장기 미접속, 계정 삭제 등으로 권한 위임을 할 수 없는 경우
    - **처리 주체:** 시스템
    - **프로세스 (MVP 단순화):** 그룹장이 유고 상태가 되면, 시스템은 해당 그룹 내의 멤버 중 **가입일이 가장 오래되고 학년 정보가 높은 멤버를 임시 그룹장으로 자동 지정**한다. (별도 관리자 개입 없음)

**4. 데이터 및 정책**

- **4.1. 데이터 삭제 정책:**
    - **그룹/워크스페이스 삭제:** 그룹 삭제 시, 해당 그룹 및 워크스페이스의 모든 데이터(멤버들의 게시물 포함)는 복구 불가능하게 **즉시 영구 삭제된다.**
    - **사용자 탈퇴:** 사용자가 서비스를 탈퇴하더라도, 다른 멤버들의 대화 흐름 유지를 위해 작성했던 메시지와 댓글은 **삭제되지 않고 '(탈퇴한 사용자)'로 익명화 처리**된다.
    - **초기 개발 단계 (MVP):** 상위 그룹이 삭제되면, 소속된 모든 하위 그룹도 **연쇄적으로 함께 삭제된다.** (단, 이 정책은 서비스 안정성에 위험이 될 수 있음을 인지하고 추후 개선 과제로 남긴다.)

### 5. API 명세 (v1.5 - 워크스페이스 통합 API 반영)

> **✅ 구현 완료:** 아래 모든 API 엔드포인트가 백엔드에서 완전 구현되었습니다.

| 기능 | HTTP Method | URI | Request Body | Response Body | 설명 | 구현상태 |
| --- | --- | --- | --- | --- | --- | --- |
| 그룹 목록 조회 | GET | /groups | | `List<GroupDto>` | 전체 그룹 목록을 조회합니다. (탐색용) | ✅ |
| **그룹 탐색/검색** | **GET** | **/groups/explore?query=...&tags=...&recruiting=true** | | `PagedGroupDto` | 검색어, 태그, 모집 상태로 그룹을 필터링하여 조회합니다. | ✅ |
| 그룹 상세 조회 | GET | /groups/{groupId} | | `GroupDetailDto` | 특정 그룹의 상세 정보/소개를 조회합니다. (비회원용) | ✅ |
| **워크스페이스 조회** | **GET** | **/groups/{groupId}/workspace** | | `WorkspaceDto` | 회원이 속한 그룹의 워크스페이스 정보(공지, 채널 목록 등)를 조회합니다. | ✅ |
| 그룹 가입 신청 | POST | /groups/{groupId}/join | `JoinRequest` | (202 Accepted) | 특정 그룹에 가입을 신청합니다. | ✅ |
| 가입 신청 취소 | DELETE | /groups/{groupId}/join | | (204 No Content) | 보류 중인 가입 신청을 취소합니다. | ✅ |
| **멤버 목록 조회** | **GET** | **/groups/{groupId}/members?status=approved\|pending** | | `List<MemberDto>` | 그룹의 멤버 목록을 상태(현재 멤버/가입 대기자)에 따라 조회합니다. | ✅ |
| **가입 승인/반려** | **POST** | **/groups/{groupId}/members/{userId}/decision** | `DecisionRequest` | (204 No Content) | 가입 신청을 승인 또는 반려합니다. | ✅ |
| **멤버 역할 변경** | **PATCH** | **/groups/{groupId}/members/{userId}/role** | `UpdateRoleRequest` | (204 No Content) | 멤버의 역할을 변경합니다. | ✅ |
| **멤버 강제 탈퇴** | **DELETE** | **/groups/{groupId}/members/{userId}** | | (204 No Content) | 멤버를 그룹에서 강제 탈퇴시킵니다. | ✅ |
| **개인 권한 오버라이드 조회** | **GET** | **/groups/{groupId}/members/{userId}/permissions** | | `PermissionOverrideDto` | 멤버의 개인별 권한 설정을 조회합니다. | ✅ |
| **개인 권한 오버라이드 설정** | **PUT** | **/groups/{groupId}/members/{userId}/permissions** | `PermissionOverrideRequest` | (204 No Content) | 멤버의 개인별 권한을 오버라이드합니다. | ✅ |
| **그룹장 위임** | **PATCH** | **/groups/{groupId}/leader** | `DelegateLeaderRequest` | (204 No Content) | 그룹장 권한을 다른 멤버에게 위임합니다. | ✅ |
| 그룹 삭제 | DELETE | /groups/{groupId} | | (204 No Content) | 그룹 및 모든 데이터를 소프트 삭제합니다. | ✅ |
| **하위 그룹 신청** | **POST** | **/groups/{parentId}/sub-groups** | `SubGroupRequest` | (202 Accepted) | 상위 그룹에 하위 그룹 생성을 신청합니다. | ✅ |
| **하위 그룹 신청 관리** | **GET/POST** | **/groups/{groupId}/sub-group-requests** | | | 하위 그룹 신청 목록 조회 및 승인/반려 처리합니다. | ✅ |
| **채널 관리** | GET, POST, PATCH, DELETE | /groups/{groupId}/channels/{channelId} | | | 그룹 내 채널을 CRUD합니다. | ✅ |
| **역할 관리** | GET, POST, PATCH, DELETE | /groups/{groupId}/roles/{roleId} | | | 그룹 내 커스텀 역할을 CRUD합니다. | ✅ |

### 5.1. UI/UX 구현 현황 (v1.5 신규)

- **`WorkspaceScreen` 구현**: 워크스페이스의 모든 기능을 담는 메인 화면이 구현되었습니다.
- **반응형 레이아웃**:
    - **모바일**: 화면 하단의 탭 바(공지, 채널, 멤버)를 통해 주요 기능을 전환합니다.
    - **데스크탑**: 화면 좌측의 고정 사이드바를 통해 채널 목록과 관리 메뉴에 빠르게 접근할 수 있습니다.
- **접근 제어 및 가입 유도**:
    - 그룹 멤버가 아닌 사용자가 워크스페이스에 접근 시, "접근 권한이 없습니다"라는 메시지와 함께 **'가입 신청하기' 버튼을 제공**하여 자연스럽게 멤버 가입을 유도합니다.
    - API 요청 실패, 로딩 상태 등 다양한 시나리오에 대응하는 UI가 구현되어 있습니다.

### 6. DTO (Data Transfer Object) 정의

### 6. 추가 구현 사항

**워크스페이스 자동 생성**
- 그룹 생성 시 1:1로 워크스페이스가 자동 생성됩니다.
- 기본 채널(공지채널, 자유채널)이 자동으로 생성됩니다.

**소프트 삭제 정책**
- 그룹 삭제 시 실제 데이터 삭제 대신 `isDeleted=true`로 마킹합니다.
- 하위 그룹 삭제 시 리패런팅(상위 그룹으로 이동) 처리됩니다.

**개인 권한 오버라이드 시스템**
- 역할 기반 권한에 더해 개인별 권한 허용/차단이 가능합니다.
- 세밀한 권한 제어가 가능합니다.

### 6. DTO (Data Transfer Object) 정의

- **GroupDto**: `{ groupId, groupName, memberCount, description }`
- **GroupDetailDto**: `{ ..., recentNotices, activities }`
- **WorkspaceDto**: `{ groupId, groupName, myRole, notices: [], channels: [], members: [] }`
- **JoinRequest**: `{ reason: String }`
- **MemberDto**: `{ userId, nickname, profileImageUrl, role, joinedAt }`
- **DecisionRequest**: `{ approve: Boolean, reason: String }`
- **UpdateRoleRequest**: `{ roleId: Long }`
- **DelegateLeaderRequest**: `{ newLeaderId: Long }`