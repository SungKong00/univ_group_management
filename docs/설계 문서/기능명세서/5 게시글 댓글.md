## 게시물 및 댓글 기능 명세서 (최종 확정본 v1.4)

### **1. 기능 목표**

워크스페이스 내 채널에서 멤버들이 자유롭게 정보를 공유하고 의견을 나눌 수 있는 직관적인 소통 환경을 제공한다.

### 2. 기본 구조 (채팅 형식)

- **표시 방식**: 채널 진입 시 최신 메시지가 가장 하단에 표시되는 실시간 채팅 형식(예: Slack)을 따릅니다.
- **입력창(Composer)**: 메시지 입력창은 화면 하단에 고정됩니다.

### **3. 게시물(메시지) 상세 명세**

- **3.1. 게시물의 구성 요소**
    - **작성자 정보:** 프로필 사진, 닉네임
    - **작성 시간:** (예: '5분 전', '2025-09-05')
    - **본문(Content):** 텍스트 기반의 내용. (Slack처럼 '제목' 필드를 과감히 없애고 본문만으로 구성)
    - **반응(Reaction):** '좋아요' 또는 특정 이모티콘
    - **댓글 수:** 현재 달린 댓글의 개수
- **3.2. 게시물 기본 기능 (CRUD)**
    - **작성(Create):**
        - 사용자는 자신이 '작성 가능 역할'을 가진 채널에서만 글을 작성할 수 있다.
        - 채널 하단에 위치한 입력창(Composer)에 텍스트를 입력하고 파일을 첨부하여 게시한다.
    - **조회(Read):**
        - 사용자는 자신이 '열람 가능 역할'을 가진 채널의 모든 게시물을 조회할 수 있다.
    - **수정(Update):**
        - 사용자는 **자신이 작성한 게시물만** 수정할 수 있다.
    - **삭제(Delete):**
        - 사용자는 **자신이 작성한 게시물만** 삭제할 수 있다.
        - 단, **'채널 관리' 권한**을 가진 멤버는 타인의 게시물도 삭제할 수 있다. (중재 기능)

### 3. 댓글 상세 명세 및 정책

- **구조**: 각 메시지에 종속되는 **스레드(Thread)** 개념으로 관리됩니다.
- **개발 아키텍처 (점진적 확장)**:
    - **MVP**: **1단계 댓글(대댓글 미지원)**만 구현합니다.
    - **DB 설계**: 추후 대댓글 기능 확장을 위해, `Comment` 테이블에 `parent_comment_id` 필드를 **미리 포함**하여 설계하고 MVP에서는 `null` 값을 저장합니다.
    - **3.2. 삭제 정책 (신규 정책):** 사용자가 **부모 댓글을 삭제할 경우, 해당 댓글에 달린 모든 대댓글도 함께 영구적으로 삭제된다.**

### 4. API 명세 (UI/UX 명세서 v1.0 기준)

| 기능 | HTTP Method | URI | Request Body | Response Body | 설명 |
| --- | --- | --- | --- | --- | --- |
| 게시물 목록 조회 | GET | /channels/{channelId}/posts?cursor={cursor} | | `PagedResult<PostDto>` | 특정 채널의 게시물 목록을 커서 기반으로 조회합니다. |
| 게시물 작성 | POST | /channels/{channelId}/posts | `CreatePostRequest` | `PostDto` | 새 게시물을 작성합니다. (파일은 사전 업로드 후 ID 첨부) |
| 게시물 수정 | PATCH | /posts/{postId} | `UpdatePostRequest` | `PostDto` | 기존 게시물을 수정합니다. (UI는 낙관적 업데이트 적용) |
| 게시물 삭제 | DELETE | /posts/{postId} | | (204 No Content) | 게시물을 삭제합니다. |
| **게시물 반응 추가** | **POST** | **/posts/{postId}/reactions** | **`CreateReactionRequest`** | `ReactionDto` | 게시물에 반응(이모지)을 추가합니다. |
| **게시물 반응 삭제** | **DELETE** | **/posts/{postId}/reactions** | **`DeleteReactionRequest`** | (204 No Content) | 게시물 반응을 삭제합니다. |
| 댓글 목록 조회 | GET | /posts/{postId}/comments | | `List<CommentDto>` | 특정 게시물의 댓글 목록을 조회합니다. |
| 댓글 작성 | POST | /posts/{postId}/comments | `CreateCommentRequest` | `CommentDto` | 새 댓글을 작성합니다. |
| 댓글 수정 | PATCH | /comments/{commentId} | `UpdateCommentRequest` | `CommentDto` | 기존 댓글을 수정합니다. |
| 댓글 삭제 | DELETE | /comments/{commentId} | | (204 No Content) | 댓글을 삭제합니다. (대댓글 연쇄 삭제 처리) |
| **파일 업로드** | **POST** | **/files** | **(multipart/form-data)** | `FileUploadResponse` | 게시물/댓글에 첨부할 파일을 사전 업로드하고 파일 ID를 받습니다. |

### 5. DTO (Data Transfer Object) 정의

- **PagedResult<T>**
    - `data: List<T>`
    - `nextCursor: String`
- **PostDto**
    - `postId: Long`
    - `author: UserSummaryDto`
    - `content: String`
    - `createdAt: DateTime`
    - `reactions: List<ReactionDto>`
    - `commentCount: Int`
- **CommentDto**
    - `commentId: Long`
    - `author: UserSummaryDto`
    - `content: String`
    - `createdAt: DateTime`
- **CreatePostRequest**
    - `content: String`
    - `attachmentIds: List<String>` (Optional)
- **UpdatePostRequest** / **CreateCommentRequest** / **UpdateCommentRequest**
    - `content: String`
- **CreateReactionRequest**
    - `emoji: String`
- **DeleteReactionRequest**
    - `emoji: String`
- **FileUploadResponse**
    - `fileId: String`
    - `fileUrl: String`
- **UserSummaryDto**
    - `userId: Long`
    - `nickname: String`
    - `profileImageUrl: String`
- **ReactionDto**
    - `emoji: String`
    - `count: Int`
    - `reactedByMe: Boolean`