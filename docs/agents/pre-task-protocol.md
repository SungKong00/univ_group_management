# ⚙️ Pre-Task Protocol (작업 시작 프로토콜)

모든 에이전트는 **실제 구현 시작 전**에 이 프로토콜을 반드시 따릅니다.

> **원칙**: "요청 → 파악 → 검증 → 승인 → 실행"

---

## 4단계 프로토콜

### 1단계: 마스터 플랜 확인
**목적**: 작업 관련 핵심 문서 1차 파악

**실행 방법**:
- `CLAUDE.md` 파일 읽기
- "빠른 네비게이션" 섹션에서 해당 도메인의 핵심 문서 목록 확인
- "📚 컨텍스트 가이드" 섹션에서 개발 시작 전 필독 문서 파악

**산출물**: 읽을 문서 목록 (5-10개)

### 2단계: 키워드 기반 동적 탐색
**목적**: 고정된 목록에 의존하지 않고 전체 컨텍스트 확보

**실행 방법**:
- 핵심 키워드 식별 (예: "권한", "모집", "캘린더", "권한", etc.)
- Grep 도구로 `docs/` 폴더 전체 검색
- Glob 도구로 관련 파일 패턴 검색
- 숨겨진 제약사항이나 규칙 발견

**예시**:
```bash
# 권한 관련 문서 모두 찾기
grep -r "permission\|권한" docs/ | grep -i "\.md"

# 특정 패턴의 파일 찾기
find docs/ -name "*permission*" -o -name "*권한*"
```

**산출물**: 추가로 발견된 문서 목록, 제약사항 정리

### 3단계: 컨텍스트 분석 요약 제출
**목적**: 사용자에게 파악한 모든 정보를 투명하게 보고

**작성 형식**:
```markdown
### 📝 컨텍스트 분석 요약

**작업 목표**: (사용자 요청을 한 문장으로 요약)

**핵심 컨텍스트**:
- 규칙 1: (예: 100줄 원칙 준수)
- 규칙 2: (예: @PreAuthorize 애노테이션 사용)
- 제약사항 1: (예: 권한 계산 공식: effective_permissions = ...)
- 기존 패턴: (예: 3-layer 아키텍처 준수)

**작업 계획**:
1. (단계 1)
2. (단계 2)
3. (단계 3)

**예상 산출물**:
- (파일 1)
- (파일 2)
```

**필수 포함 항목**:
- 작업 목표 (한 문장)
- 발견한 규칙 및 제약사항 (3개 이상)
- 기존 패턴 또는 선례 (있다면)
- 단계별 작업 계획
- 예상 산출물 목록

**산출물**: 컨텍스트 분석 요약 (사용자 제출용)

### 4단계: 사용자 승인 후 작업 시작
**목적**: 사용자의 최종 승인 후 안전하게 진행

**실행 방법**:
- 3단계에서 작성한 "컨텍스트 분석 요약"을 사용자에게 제시
- 사용자 피드백 대기 (승인, 수정 요청, 중지)
- 승인 후 실제 작업 진행

**주의사항**:
- 사용자 피드백 반영 (승인과 다른 경우)
- 새로운 제약사항 발견 시 재분석 (프로토콜 재시작)
- 작업 도중 문제 발생 시 보고 및 재계획

**산출물**: 최종 구현 (승인된 계획에 따름)

---

## 에이전트별 특화 단계

### Pre-Task Protocol의 기본 4단계 외에 도메인별 추가 단계 예시

#### permission-engineer 특화
```markdown
### 5단계: 권한 매트릭스 확인
- 시스템 역할 (그룹장, 관리자, 멤버) 파악
- 각 역할의 권한 범위 확인
- 채널별 권한 바인딩 패턴 (템플릿/0 모델) 이해

### 6단계: 계층 구조 영향 분석
- 그룹 계층 (대학 → 학과 → 그룹) 권한 상속
- 권한 오버라이드 영향도 분석
```

#### frontend-debugger 특화
```markdown
### 5단계: 에러 메시지 타입 분류
- Row/Column 레이아웃 에러
- 상태 관리 에러
- 네트워크 에러
- 권한 UI 에러

### 6단계: 스택 트레이스 분석
- 에러 발생 지점 특정
- 코드 경로 추적
```

#### database-optimizer 특화
```markdown
### 5단계: 성능 기준선 설정
- 현재 응답 시간 측정
- 데이터베이스 쿼리 로그 수집
- N+1 문제 여부 진단

### 6단계: 최적화 기회 식별
- 느린 쿼리 특정
- 인덱스 누락 확인
- 캐싱 기회 발굴
```

---

## 각 에이전트 파일에서의 사용 방법

### 템플릿

```markdown
## ⚙️ 작업 시작 프로토콜

**모든 작업은 Pre-Task Protocol을 따릅니다.**

📘 상세 가이드: [Pre-Task Protocol](../../docs/agents/pre-task-protocol.md)

### 4단계 요약
1. **마스터 플랜 확인**: CLAUDE.md에서 관련 문서 파악
2. **동적 탐색**: Grep/Glob으로 전체 컨텍스트 확보
3. **분석 요약 제출**: 파악한 정보를 사용자에게 보고
4. **승인 후 실행**: 사용자 승인 후 작업 시작

### [에이전트명] 특화 단계
[에이전트별 고유한 추가 단계가 있다면 여기에 명시]

예시 (permission-engineer):
- 5단계: 권한 매트릭스 확인
- 6단계: 계층 구조 영향 분석
```

---

## 자주 하는 실수

### ❌ 잘못된 예
1. **마스터 플랜 스킵**: CLAUDE.md를 읽지 않고 바로 작업 시작
2. **고정 리스트만 사용**: Grep/Glob 탐색 없이 이미 알려진 문서만 참조
3. **분석 요약 미제출**: 사용자 승인 없이 작업 진행
4. **새로운 제약사항 무시**: 작업 중 발견한 규칙을 반영하지 않음

### ✅ 올바른 예
1. **전체 파악**: CLAUDE.md → Grep/Glob → 심층 분석
2. **투명한 보고**: 분석 요약을 사용자에게 명확히 제시
3. **사용자 승인**: 승인 후에만 작업 시작
4. **동적 대응**: 새로운 정보 발견 시 즉시 보고 및 조정

---

## 핵심 원칙 (명심할 것)

| 원칙 | 설명 |
|------|------|
| **투명성** | 발견한 모든 컨텍스트를 사용자에게 공개 |
| **신중함** | 사용자 승인 없이 작업 진행 금지 |
| **완전성** | 마스터 플랜 + 동적 탐색으로 전체 그림 파악 |
| **유연성** | 작업 중 새로운 제약사항 발견 시 즉시 조정 |

